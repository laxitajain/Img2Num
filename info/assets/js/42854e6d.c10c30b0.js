"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[8143],{28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>r});var i=s(96540);const d={},t=i.createContext(d);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:o(e.components),i.createElement(t.Provider,{value:n},e.children)}},73880:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"reference/wasm/wasm-add-module","title":"Adding a new WASM module","description":"1. Create a new directory: src/wasm/modules//.","source":"@site/docs/reference/wasm/how-to-add-a-module.md","sourceDirName":"reference/wasm","slug":"/reference/wasm/wasm-add-module","permalink":"/Img2Num/info/docs/reference/wasm/wasm-add-module","draft":false,"unlisted":false,"editUrl":"https://github.com/Ryan-Millard/Img2Num/edit/main/docs/docs/reference/wasm/how-to-add-a-module.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"id":"wasm-add-module","title":"Adding a new WASM module","sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Troubleshooting & size/ perf optimizations","permalink":"/Img2Num/info/docs/reference/wasm/wasm-troubleshooting"},"next":{"title":"Modules","permalink":"/Img2Num/info/docs/reference/wasm/modules"}}');var d=s(74848),t=s(28453);const o={id:"wasm-add-module",title:"Adding a new WASM module",sidebar_position:6},r="Step-by-step: add a new module",a={},l=[];function c(e){const n={code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"step-by-step-add-a-new-module",children:"Step-by-step: add a new module"})}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Create a new directory: ",(0,d.jsx)(n.code,{children:"src/wasm/modules/<module-name>/"}),"."]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Replace ",(0,d.jsx)(n.code,{children:"<module-name>"})," with your actual module name (lowercase, e.g., ",(0,d.jsx)(n.code,{children:"audio"}),", ",(0,d.jsx)(n.code,{children:"filters"}),")."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Add ",(0,d.jsx)(n.code,{children:"src/"}),", ",(0,d.jsx)(n.code,{children:"include/"})," directories and a ",(0,d.jsx)(n.code,{children:"CMakeLists.txt"})," file."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Make sure the module's ",(0,d.jsx)(n.code,{children:"CMakeLists.txt"})," writes output to ",(0,d.jsx)(n.code,{children:"build/"})," with ",(0,d.jsx)(n.code,{children:"index.js"})," and ",(0,d.jsx)(n.code,{children:"index.wasm"})," (the repo's alias generator expects ",(0,d.jsx)(n.code,{children:"modules/{name}/build"}),")."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"vite.config.js"})," will automatically find the module and create an alias ",(0,d.jsx)(n.code,{children:"@wasm-<module-name>"})," on next ",(0,d.jsx)(n.code,{children:"vite"})," start (or rebuild of the config). Example usage:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:"import init from '@wasm-<module-name>/index.js';\nawait init();\n"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Commit the ",(0,d.jsx)(n.code,{children:"CMakeLists.txt"})," and source files; do not commit ",(0,d.jsx)(n.code,{children:"build/"})," artifacts unless you want to vendor the WASM for static hosting without building."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h1,{id:"minimal-module-cmakeliststxt-copypaste",children:"Minimal module CMakeLists.txt (copy/paste)"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cmake",children:'# =============================================\n# <Module Name> WASM Module - CMake Build Configuration\n# =============================================\n\n# Get module name from directory\nget_filename_component(MODULE_NAME ${CMAKE_CURRENT_SOURCE_DIR} NAME)\n\n# Capitalize first letter for export name (e.g., "audio" -> "Audio")\nstring(SUBSTRING ${MODULE_NAME} 0 1 FIRST_LETTER)\nstring(TOUPPER ${FIRST_LETTER} FIRST_LETTER_UPPER)\nstring(SUBSTRING ${MODULE_NAME} 1 -1 REST_OF_NAME)\nset(CAP_MODULE_NAME "${FIRST_LETTER_UPPER}${REST_OF_NAME}")\n\n# Collect source files\nfile(GLOB_RECURSE SRC_FILES\n    "${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp"\n)\n\n# Output directory\nset(BUILD_DIR "${CMAKE_CURRENT_SOURCE_DIR}/build")\n\n# Create executable target (Emscripten produces .js + .wasm)\nadd_executable(${MODULE_NAME}_wasm ${SRC_FILES})\n\n# Include directories\ntarget_include_directories(${MODULE_NAME}_wasm PRIVATE\n    ${CMAKE_CURRENT_SOURCE_DIR}/include\n)\n\n# Shared Emscripten options\n# Adjust INITIAL_MEMORY and MAXIMUM_MEMORY based on your module\'s needs\nset(COMMON_FLAGS\n    "SHELL:-s MODULARIZE=1"\n    "SHELL:-s EXPORT_ES6=1"\n    "SHELL:-s EXIT_RUNTIME=1"\n    "SHELL:-s ENVIRONMENT=web"\n    "SHELL:-s EXPORTED_FUNCTIONS=[\'_malloc\',\'_free\']"\n    "SHELL:-s EXPORTED_RUNTIME_METHODS=[\'ccall\',\'cwrap\',\'getValue\',\'setValue\',\'HEAPU8\']"\n    "SHELL:-s INITIAL_MEMORY=256MB"\n    "SHELL:-s MAXIMUM_MEMORY=512MB"\n    "SHELL:-s ALLOW_MEMORY_GROWTH=1"\n    "SHELL:-s EXPORT_NAME=create${CAP_MODULE_NAME}Module"\n)\n\n# Apply common flags\ntarget_link_options(${MODULE_NAME}_wasm PRIVATE ${COMMON_FLAGS})\n\n# Build-type specific flags\nif(CMAKE_BUILD_TYPE STREQUAL "Debug")\n    target_compile_options(${MODULE_NAME}_wasm PRIVATE -O0 -g4)\n    target_link_options(${MODULE_NAME}_wasm PRIVATE\n        "SHELL:-s ASSERTIONS=2"\n        -g4\n    )\nelse()\n    target_compile_options(${MODULE_NAME}_wasm PRIVATE -O3)\n    target_link_options(${MODULE_NAME}_wasm PRIVATE\n        "SHELL:-s SINGLE_FILE=0"\n    )\nendif()\n\n# Set output location and name\nset_target_properties(${MODULE_NAME}_wasm PROPERTIES\n    RUNTIME_OUTPUT_DIRECTORY "${BUILD_DIR}"\n    OUTPUT_NAME "index"\n    SUFFIX ".js"\n)\n\nmessage(STATUS "Module \'${MODULE_NAME}\' configured (export: create${CAP_MODULE_NAME}Module)")\n'})}),"\n",(0,d.jsx)(n.h1,{id:"directory-structure",children:"Directory structure"}),"\n",(0,d.jsx)(n.p,{children:"Your new module should look like:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"src/wasm/modules/<module-name>/\n\u251c\u2500\u2500 CMakeLists.txt\n\u251c\u2500\u2500 include/\n\u2502   \u2514\u2500\u2500 your_header.h\n\u251c\u2500\u2500 src/\n\u2502   \u2514\u2500\u2500 main.cpp\n\u2514\u2500\u2500 build/          # Generated (gitignored)\n    \u251c\u2500\u2500 index.js\n    \u2514\u2500\u2500 index.wasm\n"})}),"\n",(0,d.jsx)(n.h1,{id:"building",children:"Building"}),"\n",(0,d.jsxs)(n.p,{children:["Once added, the module is automatically discovered by the root ",(0,d.jsx)(n.code,{children:"CMakeLists.txt"}),". Simply run:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"npm run build-wasm        # Release build\nnpm run build-wasm:debug  # Debug build with source maps\nnpm run clean-wasm        # Clean all build artifacts\n"})}),"\n",(0,d.jsx)(n.p,{children:"The build system works identically on Windows, macOS, and Linux."})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(c,{...e})}):c(e)}}}]);