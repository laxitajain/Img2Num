"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[4412],{28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>o});var i=s(96540);const t={},l=i.createContext(t);function r(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(l.Provider,{value:n},e.children)}},38790:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"reference/react/vite-config","title":"Vite Configuration","description":"Detailed explanation of the Vite configuration for the Img2Num project, including React, WASM, image tools, and custom plugins.","source":"@site/docs/reference/react/vite-config.md","sourceDirName":"reference/react","slug":"/reference/react/vite-config","permalink":"/Img2Num/info/docs/reference/react/vite-config","draft":false,"unlisted":false,"editUrl":"https://github.com/Ryan-Millard/Img2Num/edit/main/docs/docs/reference/react/vite-config.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"vite-config","title":"Vite Configuration","hide_title":false,"description":"Detailed explanation of the Vite configuration for the Img2Num project, including React, WASM, image tools, and custom plugins.","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Tests","permalink":"/Img2Num/info/docs/reference/react/pages/Editor/tests"},"next":{"title":"Components","permalink":"/Img2Num/info/docs/reference/react/components"}}');var t=s(74848),l=s(28453);const r={id:"vite-config",title:"Vite Configuration",hide_title:!1,description:"Detailed explanation of the Vite configuration for the Img2Num project, including React, WASM, image tools, and custom plugins.",sidebar_position:2},o=void 0,d={},a=[{value:"Imports",id:"imports",level:2},{value:"Utility Functions",id:"utility-functions",level:2},{value:"<code>generateWasmAliases()</code>",id:"generatewasmaliases",level:3},{value:"<code>buildWasmModules()</code>",id:"buildwasmmodules",level:3},{value:"Vite Configuration",id:"vite-configuration",level:2},{value:"Base URL",id:"base-url",level:3},{value:"Server Options",id:"server-options",level:3},{value:"Assets Include",id:"assets-include",level:3},{value:"Module Aliases",id:"module-aliases",level:3},{value:"Plugins",id:"plugins",level:3},{value:"React SWC Plugin",id:"react-swc-plugin",level:4},{value:"Image Tools",id:"image-tools",level:4},{value:"Sitemap",id:"sitemap",level:4},{value:"Contributor Credits Generator",id:"contributor-credits-generator",level:4},{value:"WASM Build on Startup",id:"wasm-build-on-startup",level:4},{value:"Watch C++ and Build WASM",id:"watch-c-and-build-wasm",level:4},{value:"WASM Build/Watch Flow",id:"wasm-buildwatch-flow",level:3}];function c(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["This file defines the Vite configuration for the ",(0,t.jsx)(n.strong,{children:"Img2Num"})," project. It handles React setup, WebAssembly modules, sitemap generation, and custom build workflows. The configuration ensures smooth development and production environments."]}),"\n",(0,t.jsx)(n.h2,{id:"imports",children:"Imports"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{style:{textAlign:"right"},children:"Import"}),(0,t.jsx)(n.th,{children:"Explanation"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"defineConfig"})}),(0,t.jsx)(n.td,{children:"Helper for strongly typed Vite configuration."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"react"})}),(0,t.jsx)(n.td,{children:"React plugin using SWC for faster builds."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"exec"})}),(0,t.jsx)(n.td,{children:"Node.js method to run shell commands, used for building WASM modules."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"path"})}),(0,t.jsx)(n.td,{children:"Node.js path utility."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"fast-glob (fg)"})}),(0,t.jsx)(n.td,{children:"Glob pattern matching for adding custom files to the watcher."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"fs"})}),(0,t.jsx)(n.td,{children:"Node.js filesystem API."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"promisify"})}),(0,t.jsxs)(n.td,{children:["Converts callback-based functions to promises for ",(0,t.jsx)(n.code,{children:"async/await"}),"."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"imagetools"})}),(0,t.jsx)(n.td,{children:"Vite plugin for on-the-fly image transformations."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"generateContributorCreditsPlugin"})}),(0,t.jsx)(n.td,{children:"Custom plugin that generates contributor credits JSON."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"right"},children:(0,t.jsx)(n.code,{children:"VitePluginSitemap"})}),(0,t.jsx)(n.td,{children:"Generates sitemap for SEO and deployment to GitHub Pages."})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"utility-functions",children:"Utility Functions"}),"\n",(0,t.jsx)(n.h3,{id:"generatewasmaliases",children:(0,t.jsx)(n.code,{children:"generateWasmAliases()"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"function generateWasmAliases() {\n  const modulesPath = path.resolve(__dirname, 'src/wasm/modules');\n  const moduleNames = fs\n    .readdirSync(modulesPath)\n    .filter((name) => fs.statSync(path.join(modulesPath, name)).isDirectory());\n  const aliases = {};\n  moduleNames.forEach((name) => {\n    aliases[`@wasm-${name}`] = path.join(modulesPath, name, 'build');\n    console.log(`Found wasm module: ${name}`);\n  });\n  return aliases;\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Dynamically creates module aliases for all WASM modules in ",(0,t.jsx)(n.code,{children:"src/wasm/modules"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Example: ",(0,t.jsx)(n.code,{children:"@wasm-image"})," \u2192 ",(0,t.jsx)(n.code,{children:"src/wasm/modules/image/build"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Allows importing WASM modules in JS/TS files using concise aliases."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"buildwasmmodules",children:(0,t.jsx)(n.code,{children:"buildWasmModules()"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"async function buildWasmModules() {\n  console.log('\ud83d\udd28 Building WASM modules on startup...');\n  try {\n    const { stdout, stderr } = await execAsync('npm run build-wasm');\n    console.log('\u2705 WASM modules built successfully');\n    if (stdout) console.log('Build output:', stdout);\n    if (stderr) console.log('Build warnings:', stderr);\n  } catch (error) {\n    console.error('\u274c Failed to build WASM modules:', error.message);\n    console.error('Make sure you have emscripten installed and npm run build-wasm is configured');\n  }\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Executes ",(0,t.jsx)(n.code,{children:"npm run build-wasm"})," asynchronously."]}),"\n",(0,t.jsx)(n.li,{children:"Logs build output and warnings."}),"\n",(0,t.jsx)(n.li,{children:"Provides instructions if the build fails."}),"\n",(0,t.jsx)(n.li,{children:"Ensures WASM modules are ready before development or production builds."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"vite-configuration",children:"Vite Configuration"}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"View Code"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"export default defineConfig({\n  base: '/Img2Num/', // important for GitHub Pages\n  server: {\n    host: '0.0.0.0', // Allow connections from outside Docker\n    port: 5173, // Match docker-compose port\n    watch: {\n      ignored: ['**/docs/**', 'src/wasm/**/*.js', 'src/wasm/**/*.wasm'],\n    },\n  },\n  assetsInclude: ['**/*.wasm'], // Ensure Vite copies .wasm files\n  resolve: {\n    alias: {\n      '@pages': path.resolve(__dirname, 'src/pages'),\n      '@assets': path.resolve(__dirname, 'src/assets'),\n      '@components': path.resolve(__dirname, 'src/components'),\n      '@utils': path.resolve(__dirname, 'src/utils'),\n      '@hooks': path.resolve(__dirname, 'src/hooks'),\n      '@workers': path.resolve(__dirname, 'src/workers'),\n      '@global-styles': path.resolve(__dirname, 'src/global-styles'),\n      '@data': path.resolve(__dirname, 'src/data'),\n      ...generateWasmAliases(),\n    },\n  },\n  plugins: [\n    react(),\n    imagetools(),\n    VitePluginSitemap({\n      hostname: 'https://ryan-millard.github.io/Img2Num',\n      dynamicRoutes: ['/', '/credits'],\n    }),\n    generateContributorCreditsPlugin(),\n    ...\n  ],\n});\n"})})]}),"\n",(0,t.jsx)(n.h3,{id:"base-url",children:"Base URL"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"base: '/Img2Num/';\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Necessary for deploying the project to GitHub Pages."}),"\n",(0,t.jsxs)(n.li,{children:["All paths will be resolved relative to ",(0,t.jsx)(n.code,{children:"/Img2Num/"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"server-options",children:"Server Options"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"server: {\n  host: '0.0.0.0',\n  port: 5173,\n  watch: {\n    ignored: ['**/docs/**', 'src/wasm/**/*.js', 'src/wasm/**/*.wasm'],\n  },\n},\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"host: '0.0.0.0'"})," allows connections from external devices (useful in Docker)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"port: 5173"})," matches the Docker Compose and default configuration (explicit for Docker)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"watch.ignored"})," prevents Vite from watching unnecessary files, improving performance."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"assets-include",children:"Assets Include"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"assetsInclude: ['**/*.wasm'];\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Ensures ",(0,t.jsx)(n.code,{children:".wasm"})," files are copied to the build output."]}),"\n",(0,t.jsx)(n.li,{children:"Necessary because WASM files are loaded at runtime."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"module-aliases",children:"Module Aliases"}),"\n",(0,t.jsx)(n.p,{children:"Provides shorthand imports across the project:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"import MyComponent from '@components/MyComponent'; // imports MyComponent from /src/components/MyComponent\nimport processWasm from '@wasm-image'; // imports WASM code from /src/wasm/modules/image/build\n"})}),"\n",(0,t.jsx)(n.h3,{id:"plugins",children:"Plugins"}),"\n",(0,t.jsx)(n.h4,{id:"react-swc-plugin",children:"React SWC Plugin"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"react();\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Provides fast JSX/TSX compilation with SWC."}),"\n",(0,t.jsx)(n.li,{children:"Replaces slower Babel-based React plugin."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"image-tools",children:"Image Tools"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"imagetools();\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Allows importing images with transformations directly in code."}),"\n",(0,t.jsx)(n.li,{children:"Example: resizing, format conversion, or optimization at build time."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"sitemap",children:"Sitemap"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"VitePluginSitemap({\n  hostname: 'https://ryan-millard.github.io/Img2Num',\n  dynamicRoutes: ['/', '/credits'],\n});\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Automatically generates ",(0,t.jsx)(n.code,{children:"sitemap.xml"})," for SEO and GitHub Pages."]}),"\n",(0,t.jsx)(n.li,{children:"Supports dynamic routes."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"contributor-credits-generator",children:"Contributor Credits Generator"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"generateContributorCreditsPlugin();\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Custom plugin that scans the repo and generates a JSON file listing contributors."}),"\n",(0,t.jsxs)(n.li,{children:["Useful for ",(0,t.jsx)(n.code,{children:"/credits"})," page or open-source acknowledgments."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"wasm-build-on-startup",children:"WASM Build on Startup"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"{\n  name: 'build-wasm-on-startup',\n  async buildStart() {\n    if (process.env.NODE_ENV === 'production') {\n      await buildWasmModules();\n    }\n  },\n  async configureServer() {\n    await buildWasmModules();\n  },\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Builds all WASM modules at the start of development or production build."}),"\n",(0,t.jsx)(n.li,{children:"Ensures WASM modules are always up-to-date before usage."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"watch-c-and-build-wasm",children:"Watch C++ and Build WASM"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"{\n  name: 'watch-cpp-and-build-wasm',\n  __isBuilding: false,\n  handleHotUpdate({ file }) {\n    if ((file.endsWith('.cpp') || file.endsWith('.h')) && !this.__isBuilding) {\n      this.__isBuilding = true;\n      exec('npm run build-wasm', (err, stdout, stderr) => {\n        this.__isBuilding = false;\n        ...\n      });\n    }\n  },\n  configureServer(server) {\n    const files = fg.sync('src/wasm/**/*.{cpp,h}').map((f) => path.resolve(f));\n    files.forEach((file) => server.watcher.add(file));\n  },\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Watches all ",(0,t.jsx)(n.code,{children:".cpp"})," and ",(0,t.jsx)(n.code,{children:".h"})," files for changes."]}),"\n",(0,t.jsx)(n.li,{children:"Automatically rebuilds WASM modules when C++ source files are modified."}),"\n",(0,t.jsxs)(n.li,{children:["Prevents simultaneous builds with ",(0,t.jsx)(n.code,{children:"__isBuilding"})," flag."]}),"\n",(0,t.jsx)(n.li,{children:"Adds all WASM source files to Vite\u2019s watcher manually."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This configuration ensures:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Efficient development with hot reloading of WASM modules."}),"\n",(0,t.jsx)(n.li,{children:"Optimized production builds with prebuilt WASM modules."}),"\n",(0,t.jsx)(n.li,{children:"Easy imports using aliases for React components, hooks, utils, and WASM modules."}),"\n",(0,t.jsx)(n.li,{children:"Automatic sitemap generation and contributor credit management."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"wasm-buildwatch-flow",children:"WASM Build/Watch Flow"}),"\n",(0,t.jsx)(n.p,{children:"The following diagram illustrates how Vite interacts with WASM modules during development and production builds:"}),"\n",(0,t.jsx)(n.mermaid,{value:'flowchart TD\n    A["Start Vite Dev Server or Production Build"] --\x3e B{"Build WASM Modules?"}\n    B --\x3e|Dev Server| C["Run buildWasmModules"]\n    B --\x3e|Production| C\n    C --\x3e D["WASM modules ready in /build folder"]\n    D --\x3e E["Aliases @wasm-{module} point to build folder"]\n    A --\x3e F{"Hot Update Detected?"}\n    F --\x3e|C++/.h file changed| G["Check __isBuilding flag"]\n    G --\x3e|false| H["Run npm run build-wasm"]\n    H --\x3e I["Update WASM modules in /build"]\n    I --\x3e J["Reset __isBuilding flag"]\n    F --\x3e|Other files| K["No action (Vite will handle it)"]\n    D --\x3e L["Vite serves React + WASM + assets"]'})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);