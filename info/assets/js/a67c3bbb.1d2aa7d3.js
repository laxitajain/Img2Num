"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[7515],{28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>o});var i=s(96540);const r={},l=i.createContext(r);function t(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(l.Provider,{value:n},e.children)}},64346:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>m,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"reference/wasm/modules/cmake-root-orchestrator","title":"CMake Root Orchestrator","description":"Cross-platform CMake build system for WebAssembly modules in Img2Num, replacing Makefiles.","source":"@site/docs/reference/wasm/modules/cmake-root-orchestrator.md","sourceDirName":"reference/wasm/modules","slug":"/reference/wasm/modules/cmake-root-orchestrator","permalink":"/Img2Num/info/docs/reference/wasm/modules/cmake-root-orchestrator","draft":false,"unlisted":false,"editUrl":"https://github.com/Ryan-Millard/Img2Num/edit/main/docs/docs/reference/wasm/modules/cmake-root-orchestrator.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"cmake-root-orchestrator","title":"CMake Root Orchestrator","description":"Cross-platform CMake build system for WebAssembly modules in Img2Num, replacing Makefiles.","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Overview","permalink":"/Img2Num/info/docs/reference/wasm/modules/overview"},"next":{"title":"Image Module","permalink":"/Img2Num/info/docs/reference/wasm/modules/image"}}');var r=s(74848),l=s(28453);const t={id:"cmake-root-orchestrator",title:"CMake Root Orchestrator",description:"Cross-platform CMake build system for WebAssembly modules in Img2Num, replacing Makefiles.",sidebar_position:2},o="WASM Root Orchestrator - CMake Build System",d={},c=[{value:"Key Features",id:"key-features",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Emscripten Check",id:"emscripten-check",level:2},{value:"Build Type",id:"build-type",level:2},{value:"Automatic Module Discovery",id:"automatic-module-discovery",level:2},{value:"Usage",id:"usage",level:2},{value:"Development Build",id:"development-build",level:3},{value:"Production Integration",id:"production-integration",level:3},{value:"Summary",id:"summary",level:2},{value:"WASM Build Flow (CMake \u2192 Vite Integration)",id:"wasm-build-flow-cmake--vite-integration",level:3},{value:"Explanation of Flow:",id:"explanation-of-flow",level:3}];function a(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"wasm-root-orchestrator---cmake-build-system",children:"WASM Root Orchestrator - CMake Build System"})}),"\n",(0,r.jsxs)(n.p,{children:["This file serves as the ",(0,r.jsx)(n.strong,{children:"root CMake build orchestrator"})," for all WebAssembly (WASM) modules in the ",(0,r.jsx)(n.strong,{children:"Img2Num"})," project.",(0,r.jsx)(n.br,{}),"\n","It provides a cross-platform alternative to traditional Makefiles and integrates seamlessly with Emscripten for compiling C++ code to WASM."]}),"\n",(0,r.jsxs)(n.p,{children:["It was introduced in ",(0,r.jsx)(n.a,{href:"https://github.com/Ryan-Millard/Img2Num/pull/93",children:"PR #93"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cross-platform:"})," Works on Windows, macOS, and Linux with Emscripten."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Automatic module discovery:"})," Detects and adds any submodule with its own ",(0,r.jsx)(n.code,{children:"CMakeLists.txt"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Standardized build configuration:"})," Defaults to ",(0,r.jsx)(n.code,{children:"C++17"})," and ",(0,r.jsx)(n.code,{children:"Release"})," mode."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Emscripten integration:"})," Ensures the build system is executed with Emscripten (",(0,r.jsx)(n.code,{children:"emcmake"}),")."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cmake",children:"cmake_minimum_required(VERSION 3.16)\nproject(Img2NumWASM LANGUAGES CXX)\n\nset(CMAKE_CXX_STANDARD 17)\nset(CMAKE_CXX_STANDARD_REQUIRED ON)\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cmake_minimum_required(VERSION 3.16)"})," ensures a modern CMake version."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"project(Img2NumWASM LANGUAGES CXX)"})," declares the project and specifies C++ as the language."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"CMAKE_CXX_STANDARD 17"})," ensures all modules are compiled with ",(0,r.jsx)(n.strong,{children:"C++17"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"CMAKE_CXX_STANDARD_REQUIRED ON"})," enforces the C++17 standard strictly."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"emscripten-check",children:"Emscripten Check"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cmake",children:'if(NOT EMSCRIPTEN)\n    message(FATAL_ERROR\n        "This project must be built with Emscripten.\\n"\n        "Use: emcmake cmake .. && cmake --build .\\n"\n        "See docs for installation: https://emscripten.org/docs/getting_started/"\n    )\nendif()\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Ensures the project is built with ",(0,r.jsx)(n.strong,{children:"Emscripten"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["If not, it exits with a ",(0,r.jsx)(n.strong,{children:"fatal error"})," and provides instructions to the developer."]}),"\n",(0,r.jsx)(n.li,{children:"Helps prevent accidental builds with incompatible toolchains."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"build-type",children:"Build Type"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cmake",children:'if(NOT CMAKE_BUILD_TYPE)\n    set(CMAKE_BUILD_TYPE Release CACHE STRING "Build type" FORCE)\nendif()\n\nmessage(STATUS "Build type: ${CMAKE_BUILD_TYPE}")\nmessage(STATUS "Emscripten: ${EMSCRIPTEN_ROOT_PATH}")\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Defaults the build type to ",(0,r.jsx)(n.code,{children:"Release"})," if not explicitly set."]}),"\n",(0,r.jsx)(n.li,{children:"Prints the build type and Emscripten root path for developer visibility."}),"\n",(0,r.jsx)(n.li,{children:"Ensures consistent optimization levels across all modules."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"automatic-module-discovery",children:"Automatic Module Discovery"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cmake",children:'file(GLOB MODULE_DIRS "${CMAKE_CURRENT_SOURCE_DIR}/modules/*")\nforeach(MODULE_DIR ${MODULE_DIRS})\n    if(IS_DIRECTORY ${MODULE_DIR} AND EXISTS "${MODULE_DIR}/CMakeLists.txt")\n        get_filename_component(MODULE_NAME ${MODULE_DIR} NAME)\n        message(STATUS "Adding module: ${MODULE_NAME}")\n        add_subdirectory(${MODULE_DIR})\n    endif()\nendforeach()\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"file(GLOB MODULE_DIRS ...)"})," lists all directories inside ",(0,r.jsx)(n.code,{children:"modules/"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Checks each directory to see if it contains a ",(0,r.jsx)(n.code,{children:"CMakeLists.txt"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["If found, adds it as a ",(0,r.jsx)(n.strong,{children:"subdirectory"}),", effectively including the module in the build."]}),"\n",(0,r.jsx)(n.li,{children:"Prints a status message for each module added."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["This allows ",(0,r.jsx)(n.strong,{children:"plug-and-play addition of new WASM modules"}),":\nJust create a new folder under ",(0,r.jsx)(n.code,{children:"modules/"})," with its own ",(0,r.jsx)(n.code,{children:"CMakeLists.txt"}),", and the root orchestrator automatically includes it."]}),"\n",(0,r.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(n.h3,{id:"development-build",children:"Development Build"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"emcmake cmake ..\ncmake --build .\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"emcmake"})," ensures the proper Emscripten environment is used."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cmake --build ."})," compiles all modules to WASM."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"production-integration",children:"Production Integration"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The resulting WASM files are placed in each module\u2019s ",(0,r.jsx)(n.code,{children:"build"})," folder."]}),"\n",(0,r.jsxs)(n.li,{children:["The Vite configuration automatically discovers these using aliases like ",(0,r.jsx)(n.code,{children:"@wasm-{module}"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsxs)(n.p,{children:["This CMake root orchestrator provides a ",(0,r.jsx)(n.strong,{children:"scalable and maintainable system"})," for building all WASM modules in Img2Num:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Enforces ",(0,r.jsx)(n.strong,{children:"C++17"})," standard."]}),"\n",(0,r.jsxs)(n.li,{children:["Requires ",(0,r.jsx)(n.strong,{children:"Emscripten"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Defaults to ",(0,r.jsx)(n.strong,{children:"Release builds"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Automatically discovers modules."}),"\n",(0,r.jsxs)(n.li,{children:["Integrates smoothly with the ",(0,r.jsx)(n.strong,{children:"Vite WASM workflow"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["It eliminates manual Makefile management and allows contributors to ",(0,r.jsx)(n.strong,{children:"add new modules effortlessly"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"wasm-build-flow-cmake--vite-integration",children:"WASM Build Flow (CMake \u2192 Vite Integration)"}),"\n",(0,r.jsx)(n.p,{children:"The diagram below illustrates how the root CMake orchestrator builds WASM modules and integrates with Vite for both development and production environments."}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"This diagram shows the full end-to-end WASM build flow from CMake to Vite and how development vs production builds differ."})}),"\n",(0,r.jsx)(n.mermaid,{value:'flowchart TD\n    %% Start\n    A["Run emcmake cmake .."] --\x3e B["Root CMakeLists.txt"]\n\n    %% Emscripten check\n    B --\x3e C{"Emscripten installed?"}\n    C --\x3e|Yes| D["Set C++17 and Release build"]\n    C --\x3e|No| E["Fatal Error: Install Emscripten"]\n\n    %% Module discovery\n    D --\x3e F["Auto-discover modules in modules/ folder"]\n    F --\x3e G["For each module with CMakeLists.txt"]\n    G --\x3e H["add_subdirectory(module)"]\n    H --\x3e I["Compile module to WASM"]\n\n    %% WASM output\n    I --\x3e J["WASM output in module/build folder"]\n\n    %% Integration with Vite\n    J --\x3e K{"Vite Environment?"}\n    K --\x3e|Development| L["Hot-reload WASM with dev server"]\n    K --\x3e|Production| M["Use prebuilt WASM modules"]\n    L --\x3e N["Vite serves React + WASM + assets"]\n    M --\x3e N'}),"\n",(0,r.jsx)(n.h3,{id:"explanation-of-flow",children:"Explanation of Flow:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Start:"})," Run ",(0,r.jsx)(n.code,{children:"emcmake cmake .."})," to initialize Emscripten environment."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Root CMakeLists.txt:"})," Sets build configuration, ensures C++17 and Release mode."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Emscripten Check:"})," Fails immediately if Emscripten is not installed."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Module Discovery:"})," Automatically finds modules in ",(0,r.jsx)(n.code,{children:"modules/"})," folder with ",(0,r.jsx)(n.code,{children:"CMakeLists.txt"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Compilation:"})," Each module is added via ",(0,r.jsx)(n.code,{children:"add_subdirectory"})," and compiled to WASM."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"WASM Output:"})," Compiled files go to ",(0,r.jsx)(n.code,{children:"module/build"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Vite Integration:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Development:"})," Hot-reloads WASM modules on source changes."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Production:"})," Uses prebuilt WASM modules."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Final:"})," React + WASM modules are served by Vite with proper aliases."]}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);