"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[6365],{4235:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"project-scripts/help-scripts/scripts-guide","title":"Scripts & help CLI","description":"This page describes the changes introduced in PR #135 \u2014 Add scriptsInfo metadata and CI validation for script documentation","source":"@site/docs/project-scripts/help-scripts/scripts-guide.md","sourceDirName":"project-scripts/help-scripts","slug":"/project-scripts/help-scripts/scripts-guide","permalink":"/Img2Num/info/docs/project-scripts/help-scripts/scripts-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/Ryan-Millard/Img2Num/edit/main/docs/docs/project-scripts/help-scripts/scripts-guide.md","tags":[],"version":"current","frontMatter":{"title":"Scripts & help CLI","sidebar_label":"Scripts & help"},"sidebar":"tutorialSidebar","previous":{"title":"\u2753 Help Scripts","permalink":"/Img2Num/info/docs/project-scripts/help-scripts/"},"next":{"title":"\u270d\ufe0f Writing Documentation","permalink":"/Img2Num/info/docs/category/\ufe0f-writing-documentation"}}');var r=i(74848),c=i(28453);const t={title:"Scripts & help CLI",sidebar_label:"Scripts & help"},l=void 0,d={},o=[{value:"What&#39;s in this page",id:"whats-in-this-page",level:2},{value:"<code>scriptsInfo</code> \u2014 schema &amp; examples",id:"scriptsinfo--schema--examples",level:2},{value:"Adding or updating scripts",id:"adding-or-updating-scripts",level:2},{value:"<code>validate-scripts</code> tool &amp; CI",id:"validate-scripts-tool--ci",level:2},{value:"CI integration",id:"ci-integration",level:3},{value:"Refactored <code>help</code> CLI",id:"refactored-help-cli",level:2},{value:"Usage Examples",id:"usage-examples",level:3},{value:"CLI features",id:"cli-features",level:3},{value:"Shared utilities",id:"shared-utilities",level:2},{value:"Troubleshooting &amp; common failures",id:"troubleshooting--common-failures",level:2},{value:"Contributing &amp; making changes",id:"contributing--making-changes",level:2},{value:"Files touched in the PR (helpful reference)",id:"files-touched-in-the-pr-helpful-reference",level:2}];function a(e){const s={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.p,{children:["This page describes the changes introduced in ",(0,r.jsxs)(s.a,{href:"https://github.com/Ryan-Millard/Img2Num/pull/135",children:["PR #135 \u2014 Add ",(0,r.jsx)(s.code,{children:"scriptsInfo"})," metadata and CI validation for script documentation"]}),"\nand documents how to use the new ",(0,r.jsx)(s.code,{children:"scriptsInfo"})," metadata, the ",(0,r.jsx)(s.code,{children:"validate-scripts"})," tool, the refactored ",(0,r.jsx)(s.code,{children:"help"})," CLIs, and the CI integration that validates script documentation on PRs."]}),"\n",(0,r.jsx)(s.admonition,{title:"Short Summary",type:"info",children:(0,r.jsxs)(s.p,{children:["Package-level ",(0,r.jsx)(s.code,{children:"scriptsInfo"})," is now the single source of truth for documenting custom npm scripts.\nThe repo includes a ",(0,r.jsx)(s.code,{children:"validate-scripts"})," check in ",(0,r.jsx)(s.code,{children:"ci.yml"})," that enforces a strict 1:1 mapping between ",(0,r.jsx)(s.code,{children:"scripts"})," and ",(0,r.jsx)(s.code,{children:"scriptsInfo"}),".\nThe ",(0,r.jsx)(s.code,{children:"help"})," CLIs were refactored to read this metadata and a GitHub Actions workflow runs this validation on script-related changes and can annotate PRs when validation fails."]})}),"\n",(0,r.jsx)(s.h2,{id:"whats-in-this-page",children:"What's in this page"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"scriptsInfo"})," schema and examples"]}),"\n",(0,r.jsx)(s.li,{children:"How to add or update scripts"}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"validate-scripts"})," usage and CI integration"]}),"\n",(0,r.jsxs)(s.li,{children:["Refactored ",(0,r.jsx)(s.code,{children:"help"})," CLI and fuzzy search usage"]}),"\n",(0,r.jsx)(s.li,{children:"Location of shared libraries and utilities"}),"\n",(0,r.jsx)(s.li,{children:"Troubleshooting & tips"}),"\n"]}),"\n",(0,r.jsxs)(s.h2,{id:"scriptsinfo--schema--examples",children:[(0,r.jsx)(s.code,{children:"scriptsInfo"})," \u2014 schema & examples"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"package.json"})," (root and ",(0,r.jsx)(s.code,{children:"docs/package.json"}),") now support a top-level ",(0,r.jsx)(s.code,{children:"scriptsInfo"})," object. It provides structured documentation for custom ",(0,r.jsx)(s.code,{children:"npm"})," scripts and is intended to be human- and machine-readable."]}),"\n",(0,r.jsx)(s.p,{children:"A minimal example:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",metastring:'title="scriptsInfo comes before scripts to serve as a clearer interface to anyone viewing the file"',children:'{\n  "scriptsInfo": {\n    "build-wasm": {\n      "group": "build",\n      "desc": "Build the WebAssembly modules used by the app.",\n      "args": ["<target>", "Optional target; e.g. \'release\' or \'debug\'"]\n    },\n    "help": {\n      "group": "dev",\n      "desc": ["Interactive help for available npm scripts."],\n      "args": []\n    }\n  },\n  "scripts": {\n    "build-wasm": "make -C src/wasm build",\n    "help": "node scripts/help.js"\n  }\n}\n'})}),"\n",(0,r.jsx)(s.admonition,{title:"Notes on the schema used in this PR:",type:"note",children:(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"scriptsInfo"})," is an object whose keys exactly match the ",(0,r.jsx)(s.code,{children:"scripts"})," keys in ",(0,r.jsx)(s.code,{children:"package.json"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Each script entry may include:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"group"})," \u2014 logical grouping used in the help CLI (e.g. ",(0,r.jsx)(s.code,{children:"dev"}),", ",(0,r.jsx)(s.code,{children:"build"}),", ",(0,r.jsx)(s.code,{children:"docs"}),")."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"desc"})," \u2014 a string or an array of strings (multi-line descriptions supported)."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"args"})," \u2014 an array describing positional or named args the script accepts."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["The validator enforces a strict 1:1 mapping; every ",(0,r.jsx)(s.code,{children:"scripts"})," entry must have a corresponding ",(0,r.jsx)(s.code,{children:"scriptsInfo"})," entry and vice versa."]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"This ensures the scripts are properly documented."}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,r.jsx)(s.h2,{id:"adding-or-updating-scripts",children:"Adding or updating scripts"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Add your script command under ",(0,r.jsx)(s.code,{children:"scripts"})," in ",(0,r.jsx)(s.code,{children:"package.json"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Add a matching entry in ",(0,r.jsx)(s.code,{children:"scriptsInfo"})," using the schema above."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'"<script-name>": {\n  "group": "<category-it-falls-under>",\n  "desc": "<script\'s-description>",\n  "args": [\n    "<optional-arg1>",\n    "<optional-arg2>",\n    ...\n    "<optional-argx>"\n  ]\n}\n'})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"Run the validator locally before pushing:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"npm run validate-scripts\n"})}),"\n",(0,r.jsx)(s.admonition,{title:"If the validator exits non-zero",type:"caution",children:(0,r.jsxs)(s.p,{children:["Fix any missing or mismatched ",(0,r.jsx)(s.code,{children:"scriptsInfo"})," entries."]})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.h2,{id:"validate-scripts-tool--ci",children:[(0,r.jsx)(s.code,{children:"validate-scripts"})," tool & CI"]}),"\n",(0,r.jsxs)(s.p,{children:["The repository includes ",(0,r.jsx)(s.code,{children:"scripts/validate-scripts.js"})," (and an npm script ",(0,r.jsx)(s.code,{children:"validate-scripts"}),") which:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Loads ",(0,r.jsx)(s.code,{children:"./package.json"})," and ",(0,r.jsx)(s.code,{children:"./docs/package.json"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Flattens the ",(0,r.jsx)(s.code,{children:"scriptsInfo"})," structure (if grouped) and compares the set of keys with the ",(0,r.jsx)(s.code,{children:"scripts"})," object."]}),"\n",(0,r.jsx)(s.li,{children:"Exits with non-zero status if there are missing or extra entries, printing helpful error messages."}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"ci-integration",children:"CI integration"}),"\n",(0,r.jsxs)(s.p,{children:["A GitHub Actions workflow (",(0,r.jsx)(s.code,{children:".github/workflows/ci.yml"}),") was added to:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Detect if changes in a push/PR touched script-related files."}),"\n",(0,r.jsxs)(s.li,{children:["Run ",(0,r.jsx)(s.code,{children:"npm ci"})," and then ",(0,r.jsx)(s.code,{children:"npm run validate-scripts"})," when relevant."]}),"\n",(0,r.jsx)(s.li,{children:"Capture validator output and \u2014 on failures \u2014 call a reusable commenter workflow that posts the validation output back to the PR as a comment."}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"This ensures documentation for scripts can't be accidentally left out of a PR."}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsx)(s.p,{children:"Tip: If you're working on a branch and the CI complains, run the validator locally and iterate until it passes."}),"\n"]}),"\n",(0,r.jsxs)(s.h2,{id:"refactored-help-cli",children:["Refactored ",(0,r.jsx)(s.code,{children:"help"})," CLI"]}),"\n",(0,r.jsxs)(s.admonition,{type:"info",children:[(0,r.jsxs)(s.mdxAdmonitionTitle,{children:["The old ",(0,r.jsx)(s.code,{children:"help.js"})," was refactored to:"]}),(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Read ",(0,r.jsx)(s.code,{children:"scripts"})," and ",(0,r.jsx)(s.code,{children:"scriptsInfo"})," from ",(0,r.jsx)(s.code,{children:"package.json"})," (the source of truth)."]}),"\n",(0,r.jsxs)(s.li,{children:["Delegate the fuzzy listing/search UI to a shared orchestrator (",(0,r.jsx)(s.code,{children:"scripts/lib/cli-fuzzy.js"}),")."]}),"\n",(0,r.jsx)(s.li,{children:"Support multi-line descriptions and CLI args rendering."}),"\n"]})]}),"\n",(0,r.jsx)(s.h3,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",metastring:'title="Run the help CLI from the repo root"',children:"npm run help\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",metastring:'title="Arguments (immediately passed to fuzzy search)"',children:"npm run help -- help build\n"})}),"\n",(0,r.jsx)(s.h3,{id:"cli-features",children:"CLI features"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Fuzzy search of script names and descriptions."}),"\n",(0,r.jsx)(s.li,{children:"Grouped presentation of scripts."}),"\n",(0,r.jsx)(s.li,{children:"Colorized & formatted output for readability."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"shared-utilities",children:"Shared utilities"}),"\n",(0,r.jsxs)(s.p,{children:["Shared helper modules live under ",(0,r.jsx)(s.code,{children:"scripts/lib/"})," and are used by both the root app and ",(0,r.jsx)(s.code,{children:"docs"})," app:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"cli-fuzzy.js"})," \u2014 orchestrates rendering of fuzzy-search-based interactive help."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"colors.js"})," \u2014 terminal color helpers and formatting."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"read-packageJson-scripts.js"})," \u2014 small helper to safely read and return ",(0,r.jsx)(s.code,{children:"scripts"})," + ",(0,r.jsx)(s.code,{children:"scriptsInfo"})," from package manifests."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"validate-scripts.js"})," \u2014 the validator described above (also present at ",(0,r.jsx)(s.code,{children:"scripts/validate-scripts.js"}),")."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["When modifying or adding helpers, keep in mind both root and ",(0,r.jsx)(s.code,{children:"docs"})," apps import these relative utilities."]}),"\n",(0,r.jsx)(s.h2,{id:"troubleshooting--common-failures",children:"Troubleshooting & common failures"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsxs)(s.strong,{children:["Validator fails saying a script is missing from ",(0,r.jsx)(s.code,{children:"scriptsInfo"})]}),": add the scriptsInfo entry with the correct key."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsxs)(s.strong,{children:["Validator finds an extra ",(0,r.jsx)(s.code,{children:"scriptsInfo"})," key"]}),": remove or rename the ",(0,r.jsx)(s.code,{children:"scripts"})," or ",(0,r.jsx)(s.code,{children:"scriptsInfo"})," entry to match."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsxs)(s.strong,{children:["CI workflow errors about ",(0,r.jsx)(s.code,{children:"actions/checkout"})," runner"]}),": update the ",(0,r.jsx)(s.code,{children:"actions/checkout@v3"})," action ref if actionlint or GitHub Actions suggests a newer pinned version (the existing workflow contains a small actionlint note \u2014 consider updating to the latest stable minor release if needed)."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"contributing--making-changes",children:"Contributing & making changes"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Update both ",(0,r.jsx)(s.code,{children:"package.json"})," (or ",(0,r.jsx)(s.code,{children:"docs/package.json"}),") ",(0,r.jsx)(s.code,{children:"scripts"})," and ",(0,r.jsx)(s.code,{children:"scriptsInfo"})," together."]}),"\n",(0,r.jsxs)(s.li,{children:["Run ",(0,r.jsx)(s.code,{children:"npm run validate-scripts"})," locally before opening a PR."]}),"\n",(0,r.jsx)(s.li,{children:"If you touch scripts, remember CI will run the validator and may annotate your PR with the output if validation fails."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"files-touched-in-the-pr-helpful-reference",children:"Files touched in the PR (helpful reference)"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:".github/workflows/ci.yml"})}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:".github/workflows/commenter.yml"})," (reusable commenter)"]}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"package.json"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"docs/package.json"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"scripts/help.js"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"docs/scripts/help.js"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"scripts/lib/cli-fuzzy.js"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"scripts/lib/colors.js"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"scripts/lib/read-packageJson-scripts.js"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"scripts/validate-scripts.js"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,c.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453:(e,s,i)=>{i.d(s,{R:()=>t,x:()=>l});var n=i(96540);const r={},c=n.createContext(r);function t(e){const s=n.useContext(c);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),n.createElement(c.Provider,{value:s},e.children)}}}]);