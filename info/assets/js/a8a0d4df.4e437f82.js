"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[5373],{18760:(s,e,a)=>{a.d(e,{A:()=>i});var n=a(74848);const i=()=>(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,n.jsxs)("svg",{style:{width:"100%",maxWidth:"500px"},viewBox:"0 0 430 150",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"#fff"}),(0,n.jsx)("path",{d:(()=>{const s=Array.from({length:101},(s,e)=>`${10+3*e},${60-50*Math.exp(-e*e/800)}`);return`M${s[0]} `+s.slice(1).map(s=>`L${s}`).join(" ")+" L310,60 L10,60 Z"})(),fill:"rgba(255,107,107,0.3)",stroke:"#ff6b6b",strokeWidth:"2"}),(0,n.jsx)("path",{d:(()=>{const s=Array.from({length:101},(s,e)=>`${10+3*e},${120-50*Math.exp(-e*e/450)}`);return`M${s[0]} `+s.slice(1).map(s=>`L${s}`).join(" ")+" L310,120 L10,120 Z"})(),fill:"rgba(77,171,247,0.2)",stroke:"#4dabf7",strokeWidth:"2"}),(0,n.jsx)("text",{x:"200",y:"50",fontSize:"12",fill:"#ff6b6b",children:"RGB LUT"}),(0,n.jsx)("text",{x:"200",y:"110",fontSize:"12",fill:"#4dabf7",children:"CIELAB (on-the-fly)"}),(0,n.jsx)("line",{x1:"10",y1:"60",x2:"310",y2:"60",stroke:"#000",strokeWidth:"0.5"}),(0,n.jsx)("line",{x1:"10",y1:"120",x2:"310",y2:"120",stroke:"#000",strokeWidth:"0.5"}),(0,n.jsx)("text",{x:"320",y:"65",fontSize:"10",children:"Color difference \u0394RGB"}),(0,n.jsx)("text",{x:"320",y:"125",fontSize:"10",children:"Color difference \u0394LAB"})]}),(0,n.jsxs)("sub",{children:["Above, \u03c3",(0,n.jsx)("sub",{children:"r"})," = 20 for RGB and \u03c3",(0,n.jsx)("sub",{children:"r"})," = 15 for CIELAB."]})]})},28453:(s,e,a)=>{a.d(e,{R:()=>t,x:()=>r});var n=a(96540);const i={},l=n.createContext(i);function t(s){const e=n.useContext(l);return n.useMemo(function(){return"function"==typeof s?s(e):{...e,...s}},[e,s])}function r(s){let e;return e=s.disableParentContext?"function"==typeof s.components?s.components(i):s.components||i:t(s.components),n.createElement(l.Provider,{value:e},s.children)}},66543:(s,e,a)=>{a.r(e),a.d(e,{assets:()=>m,contentTitle:()=>c,default:()=>x,frontMatter:()=>r,metadata:()=>n,toc:()=>h});const n=JSON.parse('{"id":"reference/wasm/modules/image/bilateral_filter/implementation","title":"Bilateral Filter \u2014 Implementation details","description":"This page maps the conceptual steps of the Bilateral Filter to the concrete implementation.","source":"@site/docs/reference/wasm/modules/image/bilateral_filter/implementation.md","sourceDirName":"reference/wasm/modules/image/bilateral_filter","slug":"/reference/wasm/modules/image/bilateral_filter/implementation","permalink":"/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/implementation","draft":false,"unlisted":false,"editUrl":"https://github.com/Ryan-Millard/Img2Num/edit/main/docs/docs/reference/wasm/modules/image/bilateral_filter/implementation.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"implementation","title":"Bilateral Filter \u2014 Implementation details","sidebar_label":"Implementation","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Overview","permalink":"/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/overview"},"next":{"title":"API / Usage","permalink":"/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/api"}}');var i=a(74848),l=a(28453),t=a(18760);const r={id:"implementation",title:"Bilateral Filter \u2014 Implementation details",sidebar_label:"Implementation",sidebar_position:2},c="Bilateral Filter \u2014 Implementation details",m={},h=[{value:"1. Parameters &amp; Kernel Size",id:"1-parameters--kernel-size",level:2},{value:"2. Computing Weights",id:"2-computing-weights",level:2},{value:"Spatial Weights (constant per kernel)",id:"spatial-weights-constant-per-kernel",level:3},{value:"Range Weights",id:"range-weights",level:3},{value:"Precomputed RGB Range Weights (LUT)",id:"precomputed-rgb-range-weights-lut",level:4},{value:"&quot;On the Fly&quot; CIELAB Range Weights",id:"on-the-fly-cielab-range-weights",level:4},{value:"RGB LUT (Red curve and shaded area)",id:"rgb-lut-red-curve-and-shaded-area",level:5},{value:"CIELAB (Blue curve and shaded area)",id:"cielab-blue-curve-and-shaded-area",level:5},{value:"3. Sliding Window Loop",id:"3-sliding-window-loop",level:2},{value:"4. Normalization",id:"4-normalization",level:2}];function d(s){const e={admonition:"admonition",annotation:"annotation",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",math:"math",mfrac:"mfrac",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",msub:"msub",msubsup:"msubsup",msup:"msup",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,l.R)(),...s.components},{Details:a}=e;return a||function(s,e){throw new Error("Expected "+(e?"component":"object")+" `"+s+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"bilateral-filter--implementation-details",children:"Bilateral Filter \u2014 Implementation details"})}),"\n",(0,i.jsx)(e.p,{children:"This page maps the conceptual steps of the Bilateral Filter to the concrete implementation."}),"\n",(0,i.jsx)(e.admonition,{title:"Opacity",type:"important",children:(0,i.jsx)(e.p,{children:"The opacity of individual pixels in this implementation are ignored."})}),"\n",(0,i.jsx)(e.h2,{id:"1-parameters--kernel-size",children:"1. Parameters & Kernel Size"}),"\n",(0,i.jsxs)(e.p,{children:["The filter first calculates the kernel size based on the spatial standard deviation (",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"\u03c3"}),(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"p"}),(0,i.jsx)(e.mi,{children:"a"}),(0,i.jsx)(e.mi,{children:"t"}),(0,i.jsx)(e.mi,{children:"i"}),(0,i.jsx)(e.mi,{children:"a"}),(0,i.jsx)(e.mi,{children:"l"})]})]})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\sigma_{spatial}"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.7167em",verticalAlign:"-0.2861em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"\u03c3"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0359em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"s"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"p"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"a"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"ia"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.01968em"},children:"l"})]})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2861em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})})]}),")."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"const int radius = static_cast<int>(std::ceil(SIGMA_RADIUS_FACTOR * sigma_spatial));\nconst int kernel_width = 2 * radius + 1;\n"})}),"\n",(0,i.jsxs)(e.p,{children:["We primarily use ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"\u03c3"}),(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"p"}),(0,i.jsx)(e.mi,{children:"a"}),(0,i.jsx)(e.mi,{children:"t"}),(0,i.jsx)(e.mi,{children:"i"}),(0,i.jsx)(e.mi,{children:"a"}),(0,i.jsx)(e.mi,{children:"l"})]})]}),(0,i.jsx)(e.mo,{children:"\u2248"}),(0,i.jsx)(e.mn,{children:"3.0"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\sigma_{spatial} \\approx 3.0"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.7692em",verticalAlign:"-0.2861em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"\u03c3"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0359em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"s"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"p"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"a"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"ia"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.01968em"},children:"l"})]})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2861em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(e.span,{className:"mrel",children:"\u2248"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.6444em"}}),(0,i.jsx)(e.span,{className:"mord",children:"3.0"})]})]})]}),", which results in a kernel radius of 9 + the center pixel (width 19x19)."]}),"\n",(0,i.jsx)("div",{style:{textAlign:"center"},children:(0,i.jsxs)("svg",{width:"190",height:"190",viewBox:"0 0 19 19",shapeRendering:"crispEdges",xmlns:"http://www.w3.org/2000/svg",children:[[...Array(361)].map((s,e)=>{const a=e%19,n=Math.floor(e/19);return(0,i.jsx)("rect",{x:a,y:n,width:"1",height:"1",fill:"#fff",stroke:"#000",strokeWidth:"0.03"},e)}),[...Array(9)].map((s,e)=>(0,i.jsx)("text",{x:10.3+e,y:10,fontSize:"0.9",fill:"black",children:e+1},e)),(0,i.jsx)("circle",{cx:"9.5",cy:"9.5",r:"9.5",fill:"rgba(0, 0, 0, 0.5)"}),(0,i.jsx)("rect",{x:"9",y:"9",width:"1",height:"1",fill:"black"})]})}),"\n",(0,i.jsx)(e.admonition,{title:"Kernel Dimensions",type:"important",children:(0,i.jsx)(e.p,{children:"The filter kernel is always square; width = height = 2 * radius + 1."})}),"\n",(0,i.jsx)(e.h2,{id:"2-computing-weights",children:"2. Computing Weights"}),"\n",(0,i.jsxs)(e.p,{children:["To avoid computing ",(0,i.jsx)(e.code,{children:"std::exp"})," millions of times per frame, we precompute the spatial and range weights in the RGB color space\nand only the spatial weights in the CIELAB color space."]}),"\n",(0,i.jsx)(e.admonition,{title:"CIELAB Color Space Range Weight Computation",type:"note",children:(0,i.jsx)(e.p,{children:'For the CIELAB color space, the range weights are computed "on the fly" to reduce processing time.'})}),"\n",(0,i.jsxs)(e.admonition,{type:"info",children:[(0,i.jsxs)(e.p,{children:["To calculate the weights, we use ",(0,i.jsx)(e.code,{children:"gaussian"}),", a simple Gaussian function that performs the calculation:\n",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"exp"}),(0,i.jsx)(e.mo,{children:"\u2061"}),(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{fence:"true",children:"("}),(0,i.jsx)(e.mo,{children:"\u2212"}),(0,i.jsxs)(e.mfrac,{children:[(0,i.jsxs)(e.msup,{children:[(0,i.jsx)(e.mi,{children:"x"}),(0,i.jsx)(e.mn,{children:"2"})]}),(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mn,{children:"2"}),(0,i.jsxs)(e.msubsup,{children:[(0,i.jsx)(e.mi,{children:"\u03c3"}),(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"p"}),(0,i.jsx)(e.mi,{children:"a"}),(0,i.jsx)(e.mi,{children:"t"}),(0,i.jsx)(e.mi,{children:"i"}),(0,i.jsx)(e.mi,{children:"a"}),(0,i.jsx)(e.mi,{children:"l"})]}),(0,i.jsx)(e.mn,{children:"2"})]})]})]}),(0,i.jsx)(e.mo,{fence:"true",children:")"})]})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\exp\\left(-\\frac{x^2}{2\\sigma_{spatial}^2}\\right)"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.8639em",verticalAlign:"-0.7139em"}}),(0,i.jsx)(e.span,{className:"mop",children:"exp"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsxs)(e.span,{className:"minner",children:[(0,i.jsx)(e.span,{className:"mopen delimcenter",style:{top:"0em"},children:(0,i.jsx)(e.span,{className:"delimsizing size2",children:"("})}),(0,i.jsx)(e.span,{className:"mord",children:"\u2212"}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mopen nulldelimiter"}),(0,i.jsx)(e.span,{className:"mfrac",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"1.0179em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.6264em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mtight",children:"2"}),(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.03588em"},children:"\u03c3"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.8051em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.1528em",marginLeft:"-0.0359em",marginRight:"0.0714em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.5em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size3 size1 mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"s"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"p"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"a"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"ia"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.01968em"},children:"l"})]})})]}),(0,i.jsxs)(e.span,{style:{top:"-2.8448em",marginRight:"0.0714em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.5em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size3 size1 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"2"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.4861em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.23em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,i.jsxs)(e.span,{style:{top:"-3.394em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"x"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.8913em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.931em",marginRight:"0.0714em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.5em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size3 size1 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"2"})})]})})})})})]})})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.7139em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"mclose nulldelimiter"})]}),(0,i.jsx)(e.span,{className:"mclose delimcenter",style:{top:"0em"},children:(0,i.jsx)(e.span,{className:"delimsizing size2",children:")"})})]})]})})]})]}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"double gaussian(double x, double sigma) {\n    return std::exp(-(x * x) / (2.0 * sigma * sigma));\n}\n"})})]}),"\n",(0,i.jsx)(e.h3,{id:"spatial-weights-constant-per-kernel",children:"Spatial Weights (constant per kernel)"}),"\n",(0,i.jsx)(e.p,{children:"The distance pattern is the same for every pixel, so we calculate the distance-based weights once at the start."}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"spatial_weights[(ky + radius) * kernel_diameter + (kx + radius)] = gaussian(dist, sigma_spatial);\n"})}),"\n",(0,i.jsx)(e.admonition,{title:"Similarity Between Color Spaces",type:"note",children:(0,i.jsxs)(e.p,{children:["Since the color spaces (CIELAB and RGB) represent the ",(0,i.jsx)(e.strong,{children:"range component"})," of the image and not the spatial component,\nthe logic here is the same regardless of the color space (x & y are the spatial component present in every image)."]})}),"\n",(0,i.jsx)(e.h3,{id:"range-weights",children:"Range Weights"}),"\n",(0,i.jsx)(e.h4,{id:"precomputed-rgb-range-weights-lut",children:"Precomputed RGB Range Weights (LUT)"}),"\n",(0,i.jsxs)(e.p,{children:["In the RGB color space, ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"I"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"x"}),(0,i.jsx)(e.mi,{children:"i"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"}),(0,i.jsx)(e.mo,{children:"\u2212"}),(0,i.jsx)(e.mi,{children:"I"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsx)(e.mi,{children:"x"}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"I(x_i) - I(x)"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07847em"},children:"I"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"x"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mclose",children:")"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07847em"},children:"I"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"x"}),(0,i.jsx)(e.span,{className:"mclose",children:")"})]})]})]})," is simple (each channel is ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{stretchy:"false",children:"["}),(0,i.jsx)(e.mn,{children:"0"}),(0,i.jsx)(e.mo,{separator:"true",children:","}),(0,i.jsx)(e.mn,{children:"255"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"]"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"[0,255]"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mopen",children:"["}),(0,i.jsx)(e.span,{className:"mord",children:"0"}),(0,i.jsx)(e.span,{className:"mpunct",children:","}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsx)(e.span,{className:"mord",children:"255"}),(0,i.jsx)(e.span,{className:"mclose",children:"]"})]})})]}),"), so\nwe calculate the ",(0,i.jsx)(e.code,{children:"similarity score"})," for every possible color difference ahead of time and store the results in an LUT.\nThis saves computation time by allowing us to measure the color difference and look up the precomputed weight in the table during the main body of the filter."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"range_lut[i] = gaussian(static_cast<double>(std::sqrt(i)), sigma_range);\n"})}),"\n",(0,i.jsxs)(e.admonition,{title:"LUT Usage",type:"important",children:[(0,i.jsx)(e.p,{children:"We precompute a lookup table for all possible differences (0\u2013255 for each channel, or squared Euclidean differences 0\u2013195075) in\nthe RGB color space because it is small enough to store."}),(0,i.jsx)(e.p,{children:"See the corresponding information block for CIELAB to see why this differs between the color spaces."})]}),"\n",(0,i.jsx)(e.h4,{id:"on-the-fly-cielab-range-weights",children:'"On the Fly" CIELAB Range Weights'}),"\n",(0,i.jsxs)(e.p,{children:["In the CIELAB color space, the pixels are not bounded ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{stretchy:"false",children:"["}),(0,i.jsx)(e.mn,{children:"0"}),(0,i.jsx)(e.mo,{separator:"true",children:","}),(0,i.jsx)(e.mn,{children:"255"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"]"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"[0,255]"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mopen",children:"["}),(0,i.jsx)(e.span,{className:"mord",children:"0"}),(0,i.jsx)(e.span,{className:"mpunct",children:","}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsx)(e.span,{className:"mord",children:"255"}),(0,i.jsx)(e.span,{className:"mclose",children:"]"})]})})]})," per channel like RGB.\nThus, we calculate the ",(0,i.jsx)(e.code,{children:"similarity score"}),' for every possible color difference as we need them during the main body of the bilateral filter ("on the fly").']}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"w_range = gaussian(dist, sigma_range);\n"})}),"\n",(0,i.jsxs)(e.admonition,{title:'"On the fly" vs. LUT',type:"important",children:[(0,i.jsxs)(e.p,{children:["In ",(0,i.jsx)(e.strong,{children:"CIELAB"}),", the pixels are not bounded 0\u2013255 per channel in the same way:"]}),(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["L: ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{stretchy:"false",children:"["}),(0,i.jsx)(e.mn,{children:"0"}),(0,i.jsx)(e.mo,{separator:"true",children:","}),(0,i.jsx)(e.mn,{children:"100"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"]"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"[0,100]"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mopen",children:"["}),(0,i.jsx)(e.span,{className:"mord",children:"0"}),(0,i.jsx)(e.span,{className:"mpunct",children:","}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsx)(e.span,{className:"mord",children:"100"}),(0,i.jsx)(e.span,{className:"mclose",children:"]"})]})})]})]}),"\n",(0,i.jsxs)(e.li,{children:["a: roughly ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{stretchy:"false",children:"["}),(0,i.jsx)(e.mo,{children:"\u2212"}),(0,i.jsx)(e.mn,{children:"128"}),(0,i.jsx)(e.mo,{separator:"true",children:","}),(0,i.jsx)(e.mn,{children:"127"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"]"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"[\u2212128,127]"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mopen",children:"["}),(0,i.jsx)(e.span,{className:"mord",children:"\u2212"}),(0,i.jsx)(e.span,{className:"mord",children:"128"}),(0,i.jsx)(e.span,{className:"mpunct",children:","}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsx)(e.span,{className:"mord",children:"127"}),(0,i.jsx)(e.span,{className:"mclose",children:"]"})]})})]})]}),"\n",(0,i.jsxs)(e.li,{children:["b: roughly ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{stretchy:"false",children:"["}),(0,i.jsx)(e.mo,{children:"\u2212"}),(0,i.jsx)(e.mn,{children:"128"}),(0,i.jsx)(e.mo,{separator:"true",children:","}),(0,i.jsx)(e.mn,{children:"127"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"]"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"[\u2212128,127]"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mopen",children:"["}),(0,i.jsx)(e.span,{className:"mord",children:"\u2212"}),(0,i.jsx)(e.span,{className:"mord",children:"128"}),(0,i.jsx)(e.span,{className:"mpunct",children:","}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsx)(e.span,{className:"mord",children:"127"}),(0,i.jsx)(e.span,{className:"mclose",children:"]"})]})})]})]}),"\n"]}),(0,i.jsx)(e.p,{children:"But more importantly:"}),(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Continuous values:"})," After conversion from RGB, the values are floating-point.\nThe differences (",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{mathvariant:"normal",children:"\u2223"}),(0,i.jsxs)(e.msup,{children:[(0,i.jsx)(e.mi,{children:"L"}),(0,i.jsx)(e.mo,{children:"\u2217"})]}),(0,i.jsxs)(e.msup,{children:[(0,i.jsx)(e.mi,{children:"a"}),(0,i.jsx)(e.mo,{children:"\u2217"})]}),(0,i.jsxs)(e.msup,{children:[(0,i.jsx)(e.mi,{children:"b"}),(0,i.jsx)(e.mo,{children:"\u2217"})]}),(0,i.jsx)(e.mo,{children:"\u2212"}),(0,i.jsxs)(e.msup,{children:[(0,i.jsx)(e.mi,{children:"L"}),(0,i.jsx)(e.mo,{children:"\u2217"})]}),(0,i.jsxs)(e.msup,{children:[(0,i.jsx)(e.mi,{children:"a"}),(0,i.jsx)(e.mo,{children:"\u2217"})]}),(0,i.jsxs)(e.msup,{children:[(0,i.jsx)(e.mi,{children:"b"}),(0,i.jsx)(e.mo,{children:"\u2217"})]}),(0,i.jsxs)(e.msup,{children:[(0,i.jsx)(e.mi,{mathvariant:"normal",children:"\u2223"}),(0,i.jsx)(e.mn,{children:"2"})]})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"|L^*a^*b^* - L^*a^*b^*|^2"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord",children:"\u2223"}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"L"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.6887em"},children:(0,i.jsxs)(e.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mbin mtight",children:"\u2217"})})]})})})})})]}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"a"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.6887em"},children:(0,i.jsxs)(e.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mbin mtight",children:"\u2217"})})]})})})})})]}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"b"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.6887em"},children:(0,i.jsxs)(e.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mbin mtight",children:"\u2217"})})]})})})})})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.0641em",verticalAlign:"-0.25em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"L"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.6887em"},children:(0,i.jsxs)(e.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mbin mtight",children:"\u2217"})})]})})})})})]}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"a"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.6887em"},children:(0,i.jsxs)(e.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mbin mtight",children:"\u2217"})})]})})})})})]}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"b"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.6887em"},children:(0,i.jsxs)(e.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mbin mtight",children:"\u2217"})})]})})})})})]}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord",children:"\u2223"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.8141em"},children:(0,i.jsxs)(e.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"2"})})]})})})})})]})]})]})]}),") are continuous, not integers.\nSo the LUT would need to store ",(0,i.jsx)(e.strong,{children:"all possible floating-point differences"}),", which is essentially impossible."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Large dynamic range:"})," The squared Euclidean distance in Lab can be ",(0,i.jsx)(e.strong,{children:"much larger than in 8-bit RGB"}),", especially when using floating-point precision.\nPrecomputing a LUT with sufficient precision would be huge."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Precision matters:"})," Small errors in range weights in Lab are more noticeable because the filter is very sensitive to perceptual color distances.\nA coarse LUT could lead to visible artifacts."]}),"\n"]})]}),"\n",(0,i.jsxs)(a,{open:!0,children:[(0,i.jsx)("summary",{children:(0,i.jsx)("h4",{children:"RGB LUT vs CIELAB On-the-Fly Weights"})}),(0,i.jsxs)(e.p,{children:["Bilateral filtering computes a ",(0,i.jsx)(e.strong,{children:"range weight"})," for each pixel in the kernel based on the color difference between the center pixel and its neighbor."]}),(0,i.jsx)(t.A,{}),(0,i.jsx)(e.h5,{id:"rgb-lut-red-curve-and-shaded-area",children:"RGB LUT (Red curve and shaded area)"}),(0,i.jsxs)(e.p,{children:["In the RGB color space, the maximum possible color difference is limited (0\u2013255 per channel).\nThis allows us to ",(0,i.jsx)(e.strong,{children:"precompute all possible weights"})," in a ",(0,i.jsx)(e.strong,{children:"Lookup Table (LUT)"}),".\nDuring filtering, we simply ",(0,i.jsx)(e.strong,{children:"look up the weight"})," instead of recomputing it with\n",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"exp"}),(0,i.jsx)(e.mo,{children:"\u2061"}),(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{fence:"true",children:"("}),(0,i.jsx)(e.mo,{children:"\u2212"}),(0,i.jsxs)(e.mfrac,{children:[(0,i.jsxs)(e.msup,{children:[(0,i.jsx)(e.mi,{children:"x"}),(0,i.jsx)(e.mn,{children:"2"})]}),(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mn,{children:"2"}),(0,i.jsxs)(e.msubsup,{children:[(0,i.jsx)(e.mi,{children:"\u03c3"}),(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"p"}),(0,i.jsx)(e.mi,{children:"a"}),(0,i.jsx)(e.mi,{children:"t"}),(0,i.jsx)(e.mi,{children:"i"}),(0,i.jsx)(e.mi,{children:"a"}),(0,i.jsx)(e.mi,{children:"l"})]}),(0,i.jsx)(e.mn,{children:"2"})]})]})]}),(0,i.jsx)(e.mo,{fence:"true",children:")"})]})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\exp\\left(-\\frac{x^2}{2\\sigma_{spatial}^2}\\right)"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.8639em",verticalAlign:"-0.7139em"}}),(0,i.jsx)(e.span,{className:"mop",children:"exp"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsxs)(e.span,{className:"minner",children:[(0,i.jsx)(e.span,{className:"mopen delimcenter",style:{top:"0em"},children:(0,i.jsx)(e.span,{className:"delimsizing size2",children:"("})}),(0,i.jsx)(e.span,{className:"mord",children:"\u2212"}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mopen nulldelimiter"}),(0,i.jsx)(e.span,{className:"mfrac",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"1.0179em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.6264em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mtight",children:"2"}),(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.03588em"},children:"\u03c3"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.8051em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.1528em",marginLeft:"-0.0359em",marginRight:"0.0714em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.5em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size3 size1 mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"s"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"p"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"a"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"ia"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.01968em"},children:"l"})]})})]}),(0,i.jsxs)(e.span,{style:{top:"-2.8448em",marginRight:"0.0714em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.5em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size3 size1 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"2"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.4861em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.23em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,i.jsxs)(e.span,{style:{top:"-3.394em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"x"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.8913em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.931em",marginRight:"0.0714em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.5em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size3 size1 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"2"})})]})})})})})]})})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.7139em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"mclose nulldelimiter"})]}),(0,i.jsx)(e.span,{className:"mclose delimcenter",style:{top:"0em"},children:(0,i.jsx)(e.span,{className:"delimsizing size2",children:")"})})]})]})})]}),"\nfor each neighbor.\nThe discrete nature of the LUT is represented by the shaded area and the curve shows how weight decays with increasing \u0394RGB."]}),(0,i.jsx)(e.h5,{id:"cielab-blue-curve-and-shaded-area",children:"CIELAB (Blue curve and shaded area)"}),(0,i.jsxs)(e.p,{children:["In the CIELAB color space, the number of possible differences is much larger and continuous.\nPrecomputing a LUT would require enormous memory, so weights are ",(0,i.jsx)(e.strong,{children:"computed on-the-fly"}),".\nThe curve represents the weight for a given color difference \u0394LAB, and the shaded area illustrates the range of influence."]}),(0,i.jsx)(e.admonition,{type:"note",children:(0,i.jsxs)(e.p,{children:["This visual shows why RGB weights can be precomputed while CIELAB weights must be computed dynamically.\nThe ",(0,i.jsx)(e.strong,{children:"height of the curve/area corresponds to the weight"})," given by the Gaussian function: higher means more influence in the filtered pixel."]})})]}),"\n",(0,i.jsx)(e.h2,{id:"3-sliding-window-loop",children:"3. Sliding Window Loop"}),"\n",(0,i.jsxs)(e.p,{children:["The core processing happens in a nested loop over every pixel ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsx)(e.mi,{children:"y"}),(0,i.jsx)(e.mo,{separator:"true",children:","}),(0,i.jsx)(e.mi,{children:"x"}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"(y, x)"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"y"}),(0,i.jsx)(e.span,{className:"mpunct",children:","}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"x"}),(0,i.jsx)(e.span,{className:"mclose",children:")"})]})})]}),". For each pixel, we:"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Iterate"})," over the window from ",(0,i.jsx)(e.code,{children:"-radius"})," to ",(0,i.jsx)(e.code,{children:"+radius"})," (from left to right inside the effective circular range and domain of the kernel)."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Fetch"})," neighbor RGB values."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Calculate"})," color difference using squared Euclidean distance."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Lookup weights:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Spatial weights:"})," Precomputed at the start of the bilateral filter."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Range weights:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.em,{children:"RGB"}),": From LUT (precomputed at the start of the bilateral filter)."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.em,{children:"CIELAB"}),': Calculate "on the fly".']}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Accumulate"})," the weighted sum and the sum of weights."]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"4-normalization",children:"4. Normalization"}),"\n",(0,i.jsxs)(e.p,{children:["Finally, we normalize the accumulated color values by the total weight (clamped to valid RGB values: ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{stretchy:"false",children:"["}),(0,i.jsx)(e.mn,{children:"0"}),(0,i.jsx)(e.mo,{separator:"true",children:","}),(0,i.jsx)(e.mn,{children:"255"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"]"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"[0,255]"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mopen",children:"["}),(0,i.jsx)(e.span,{className:"mord",children:"0"}),(0,i.jsx)(e.span,{className:"mpunct",children:","}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsx)(e.span,{className:"mord",children:"255"}),(0,i.jsx)(e.span,{className:"mclose",children:"]"})]})})]}),") to get the filtered pixel value:"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:"result[center_idx] = static_cast<uint8_t>(std::clamp(r_acc / weight_acc, 0.0, 255.0));\n"})}),"\n",(0,i.jsx)(e.p,{children:"This ensures the pixel brightness remains consistent with the local area."})]})}function x(s={}){const{wrapper:e}={...(0,l.R)(),...s.components};return e?(0,i.jsx)(e,{...s,children:(0,i.jsx)(d,{...s})}):d(s)}}}]);