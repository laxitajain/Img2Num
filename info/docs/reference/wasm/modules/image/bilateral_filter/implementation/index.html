<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-reference/wasm/modules/image/bilateral_filter/implementation" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Bilateral Filter ‚Äî Implementation details | Img2Num</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ryan-millard.github.io/Img2Num/info/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://ryan-millard.github.io/Img2Num/info/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://ryan-millard.github.io/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/implementation/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="algolia-site-verification" content="DB4B5FEC1545D32B"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Bilateral Filter ‚Äî Implementation details | Img2Num"><meta data-rh="true" name="description" content="This page maps the conceptual steps of the Bilateral Filter to the concrete implementation."><meta data-rh="true" property="og:description" content="This page maps the conceptual steps of the Bilateral Filter to the concrete implementation."><link data-rh="true" rel="icon" href="/Img2Num/info/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://ryan-millard.github.io/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/implementation/"><link data-rh="true" rel="alternate" href="https://ryan-millard.github.io/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/implementation/" hreflang="en"><link data-rh="true" rel="alternate" href="https://ryan-millard.github.io/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/implementation/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Reference","item":"https://ryan-millard.github.io/Img2Num/info/docs/reference"},{"@type":"ListItem","position":2,"name":"WebAssembly (WASM)","item":"https://ryan-millard.github.io/Img2Num/info/docs/reference/wasm"},{"@type":"ListItem","position":3,"name":"Modules","item":"https://ryan-millard.github.io/Img2Num/info/docs/reference/wasm/modules"},{"@type":"ListItem","position":4,"name":"Image Module","item":"https://ryan-millard.github.io/Img2Num/info/docs/reference/wasm/modules/image"},{"@type":"ListItem","position":5,"name":"bilateral_filter.h","item":"https://ryan-millard.github.io/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter"},{"@type":"ListItem","position":6,"name":"Implementation","item":"https://ryan-millard.github.io/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/implementation"}]}</script><link rel="alternate" type="application/rss+xml" href="/Img2Num/info/blog/rss.xml" title="Img2Num RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Img2Num/info/blog/atom.xml" title="Img2Num Atom Feed">






<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C7LD33MNTX"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-C7LD33MNTX",{anonymize_ip:!0})</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/Img2Num/info/assets/css/styles.ce79eac9.css">
<script src="/Img2Num/info/assets/js/runtime~main.fc4eb453.js" defer="defer"></script>
<script src="/Img2Num/info/assets/js/main.8a071834.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Img2Num/info/img/favicon.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Img2Num/info/"><div class="navbar__logo"><img src="/Img2Num/info/img/favicon.svg" alt="Img2Num Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Img2Num/info/img/favicon.svg" alt="Img2Num Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Img2Num</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Img2Num/info/docs/">Documentation</a><a class="navbar__item navbar__link" href="/Img2Num/info/blog/">Blog</a><a class="navbar__item navbar__link" href="/Img2Num/info/changelog/">Changelog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/Ryan-Millard/Img2Num" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Img2Num/info/docs/"><span title="üèÑ‚Äç‚ôÇÔ∏è Img2Num Docs" class="linkLabel_WmDU">üèÑ‚Äç‚ôÇÔ∏è Img2Num Docs</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/Img2Num/info/docs/category/-introduction/"><span title="üìñ Introduction" class="categoryLinkLabel_W154">üìñ Introduction</span></a><button aria-label="Collapse sidebar category &#x27;üìñ Introduction&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/introduction/usage/"><span title="‚ùì Usage" class="linkLabel_WmDU">‚ùì Usage</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/introduction/getting-started/"><span title="üöÄ Getting Started" class="linkLabel_WmDU">üöÄ Getting Started</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/introduction/core-concepts/"><span title="üß© Core Concepts" class="linkLabel_WmDU">üß© Core Concepts</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Img2Num/info/docs/license/"><span title="‚öñÔ∏è AGPLv3 License" class="linkLabel_WmDU">‚öñÔ∏è AGPLv3 License</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/Img2Num/info/docs/category/guidelines/"><span title="Guidelines" class="categoryLinkLabel_W154">Guidelines</span></a><button aria-label="Expand sidebar category &#x27;Guidelines&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/Img2Num/info/docs/category/project-scripts/"><span title="Project Scripts" class="categoryLinkLabel_W154">Project Scripts</span></a><button aria-label="Expand sidebar category &#x27;Project Scripts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/Img2Num/info/docs/category/Ô∏è-writing-documentation/"><span title="‚úçÔ∏è Writing Documentation" class="categoryLinkLabel_W154">‚úçÔ∏è Writing Documentation</span></a><button aria-label="Expand sidebar category &#x27;‚úçÔ∏è Writing Documentation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/Img2Num/info/docs/reference/"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a><button aria-label="Collapse sidebar category &#x27;Reference&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/reference/overview/"><span title="Reference Overview" class="linkLabel_WmDU">Reference Overview</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/Img2Num/info/docs/reference/react/"><span title="React" class="categoryLinkLabel_W154">React</span></a><button aria-label="Expand sidebar category &#x27;React&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/Img2Num/info/docs/reference/wasm/"><span title="WebAssembly (WASM)" class="categoryLinkLabel_W154">WebAssembly (WASM)</span></a><button aria-label="Collapse sidebar category &#x27;WebAssembly (WASM)&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/reference/wasm/overview/"><span title="WebAssembly Overview" class="linkLabel_WmDU">WebAssembly Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/reference/wasm/wasm-setup-dependencies/"><span title="Setup &amp; Dependencies" class="linkLabel_WmDU">Setup &amp; Dependencies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/reference/wasm/wasm-using-react/"><span title="Using WASM modules in React" class="linkLabel_WmDU">Using WASM modules in React</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/reference/wasm/wasm-dev-workflow/"><span title="Development workflow &amp; watch behavior" class="linkLabel_WmDU">Development workflow &amp; watch behavior</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/reference/wasm/wasm-troubleshooting/"><span title="Troubleshooting &amp; size/ perf optimizations" class="linkLabel_WmDU">Troubleshooting &amp; size/ perf optimizations</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/reference/wasm/wasm-add-module/"><span title="Adding a new WASM module" class="linkLabel_WmDU">Adding a new WASM module</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/Img2Num/info/docs/reference/wasm/modules/"><span title="Modules" class="categoryLinkLabel_W154">Modules</span></a><button aria-label="Collapse sidebar category &#x27;Modules&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/reference/wasm/modules/overview/"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/Img2Num/info/docs/reference/wasm/modules/image/"><span title="Image Module" class="categoryLinkLabel_W154">Image Module</span></a><button aria-label="Collapse sidebar category &#x27;Image Module&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/reference/wasm/modules/image/overview/"><span title="Image Module Overview" class="linkLabel_WmDU">Image Module Overview</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/Img2Num/info/docs/reference/wasm/modules/image/fft_iterative/"><span title="fft_iterative.h" class="categoryLinkLabel_W154">fft_iterative.h</span></a><button aria-label="Expand sidebar category &#x27;fft_iterative.h&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/Img2Num/info/docs/reference/wasm/modules/image/mergeSmallRegionsInPlace/"><span title="mergeSmallRegionsInPlace.h" class="categoryLinkLabel_W154">mergeSmallRegionsInPlace.h</span></a><button aria-label="Expand sidebar category &#x27;mergeSmallRegionsInPlace.h&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/"><span title="bilateral_filter.h" class="categoryLinkLabel_W154">bilateral_filter.h</span></a><button aria-label="Collapse sidebar category &#x27;bilateral_filter.h&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/overview/"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/implementation/"><span title="Implementation" class="linkLabel_WmDU">Implementation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/api/"><span title="API / Usage" class="linkLabel_WmDU">API / Usage</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/explained/"><span title="Implementation Explained" class="linkLabel_WmDU">Implementation Explained</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/color-spaces/"><span title="Color Space Selection" class="linkLabel_WmDU">Color Space Selection</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-6 menu__list-item"><a class="menu__link" tabindex="0" href="/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/keywords/"><span title="Keywords" class="linkLabel_WmDU">Keywords</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/Img2Num/info/docs/reference/wasm/modules/image/cielab/"><span title="cielab.h" class="categoryLinkLabel_W154">cielab.h</span></a><button aria-label="Expand sidebar category &#x27;cielab.h&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/Img2Num/info/docs/reference/tools/"><span title="Tools" class="categoryLinkLabel_W154">Tools</span></a><button aria-label="Expand sidebar category &#x27;Tools&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Img2Num/info/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/Img2Num/info/docs/reference/"><span>Reference</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/Img2Num/info/docs/reference/wasm/"><span>WebAssembly (WASM)</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/Img2Num/info/docs/reference/wasm/modules/"><span>Modules</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/Img2Num/info/docs/reference/wasm/modules/image/"><span>Image Module</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/"><span>bilateral_filter.h</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Implementation</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Bilateral Filter ‚Äî Implementation details</h1></header>
<p>This page maps the conceptual steps of the Bilateral Filter to the concrete implementation.</p>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Opacity</div><div class="admonitionContent_BuS1"><p>The opacity of individual pixels in this implementation are ignored.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-parameters--kernel-size">1. Parameters &amp; Kernel Size<a href="#1-parameters--kernel-size" class="hash-link" aria-label="Direct link to 1. Parameters &amp; Kernel Size" title="Direct link to 1. Parameters &amp; Kernel Size" translate="no">‚Äã</a></h2>
<p>The filter first calculates the kernel size based on the spatial standard deviation (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>œÉ</mi><mrow><mi>s</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>a</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\sigma_{spatial}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">œÉ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ia</span><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span>).</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> radius </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">static_cast</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name keyword" style="color:#00009f">int</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">ceil</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SIGMA_RADIUS_FACTOR </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> sigma_spatial</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> kernel_width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> radius </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>We primarily use <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>œÉ</mi><mrow><mi>s</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>‚âà</mo><mn>3.0</mn></mrow><annotation encoding="application/x-tex">\sigma_{spatial} \approx 3.0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7692em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">œÉ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ia</span><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">‚âà</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">3.0</span></span></span></span>, which results in a kernel radius of 9 + the center pixel (width 19x19).</p>
<div style="text-align:center"><svg width="190" height="190" viewBox="0 0 19 19" shape-rendering="crispEdges" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="0" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="1" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="2" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="3" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="4" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="5" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="6" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="7" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="8" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="9" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="10" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="11" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="12" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="13" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="14" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="15" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="16" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="17" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="0" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="1" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="2" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="3" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="4" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="5" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="6" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="7" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="8" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="9" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="10" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="11" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="12" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="13" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="14" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="15" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="16" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="17" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><rect x="18" y="18" width="1" height="1" fill="#fff" stroke="#000" stroke-width="0.03"></rect><text x="10.3" y="10" font-size="0.9" fill="black">1</text><text x="11.3" y="10" font-size="0.9" fill="black">2</text><text x="12.3" y="10" font-size="0.9" fill="black">3</text><text x="13.3" y="10" font-size="0.9" fill="black">4</text><text x="14.3" y="10" font-size="0.9" fill="black">5</text><text x="15.3" y="10" font-size="0.9" fill="black">6</text><text x="16.3" y="10" font-size="0.9" fill="black">7</text><text x="17.3" y="10" font-size="0.9" fill="black">8</text><text x="18.3" y="10" font-size="0.9" fill="black">9</text><circle cx="9.5" cy="9.5" r="9.5" fill="rgba(0, 0, 0, 0.5)"></circle><rect x="9" y="9" width="1" height="1" fill="black"></rect></svg></div>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Kernel Dimensions</div><div class="admonitionContent_BuS1"><p>The filter kernel is always square; width = height = 2 * radius + 1.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-computing-weights">2. Computing Weights<a href="#2-computing-weights" class="hash-link" aria-label="Direct link to 2. Computing Weights" title="Direct link to 2. Computing Weights" translate="no">‚Äã</a></h2>
<p>To avoid computing <code>std::exp</code> millions of times per frame, we precompute the spatial and range weights in the RGB color space
and only the spatial weights in the CIELAB color space.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>CIELAB Color Space Range Weight Computation</div><div class="admonitionContent_BuS1"><p>For the CIELAB color space, the range weights are computed &quot;on the fly&quot; to reduce processing time.</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>To calculate the weights, we use <code>gaussian</code>, a simple Gaussian function that performs the calculation:
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>exp</mi><mo>‚Å°</mo><mrow><mo fence="true">(</mo><mo>‚àí</mo><mfrac><msup><mi>x</mi><mn>2</mn></msup><mrow><mn>2</mn><msubsup><mi>œÉ</mi><mrow><mi>s</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>a</mi><mi>l</mi></mrow><mn>2</mn></msubsup></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\exp\left(-\frac{x^2}{2\sigma_{spatial}^2}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.8639em;vertical-align:-0.7139em"></span><span class="mop">exp</span><span class="mspace" style="margin-right:0.1667em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size2">(</span></span><span class="mord">‚àí</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0179em"><span style="top:-2.6264em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">œÉ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em"><span style="top:-2.1528em;margin-left:-0.0359em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ia</span><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span><span style="top:-2.8448em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.4861em"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.931em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.7139em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em"><span class="delimsizing size2">)</span></span></span></span></span></span></p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gaussian</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> sigma</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">exp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> sigma </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> sigma</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="spatial-weights-constant-per-kernel">Spatial Weights (constant per kernel)<a href="#spatial-weights-constant-per-kernel" class="hash-link" aria-label="Direct link to Spatial Weights (constant per kernel)" title="Direct link to Spatial Weights (constant per kernel)" translate="no">‚Äã</a></h3>
<p>The distance pattern is the same for every pixel, so we calculate the distance-based weights once at the start.</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spatial_weights</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ky </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> radius</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> kernel_diameter </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kx </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> radius</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gaussian</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dist</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sigma_spatial</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Similarity Between Color Spaces</div><div class="admonitionContent_BuS1"><p>Since the color spaces (CIELAB and RGB) represent the <strong>range component</strong> of the image and not the spatial component,
the logic here is the same regardless of the color space (x &amp; y are the spatial component present in every image).</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="range-weights">Range Weights<a href="#range-weights" class="hash-link" aria-label="Direct link to Range Weights" title="Direct link to Range Weights" translate="no">‚Äã</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="precomputed-rgb-range-weights-lut">Precomputed RGB Range Weights (LUT)<a href="#precomputed-rgb-range-weights-lut" class="hash-link" aria-label="Direct link to Precomputed RGB Range Weights (LUT)" title="Direct link to Precomputed RGB Range Weights (LUT)" translate="no">‚Äã</a></h4>
<p>In the RGB color space, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>‚àí</mo><mi>I</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">I(x_i) - I(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.07847em">I</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> is simple (each channel is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>255</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,255]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">255</span><span class="mclose">]</span></span></span></span>), so
we calculate the <code>similarity score</code> for every possible color difference ahead of time and store the results in an LUT.
This saves computation time by allowing us to measure the color difference and look up the precomputed weight in the table during the main body of the filter.</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">range_lut</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gaussian</span><span class="token punctuation" style="color:#393A34">(</span><span class="token generic-function function" style="color:#d73a49">static_cast</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name keyword" style="color:#00009f">double</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">sqrt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sigma_range</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>LUT Usage</div><div class="admonitionContent_BuS1"><p>We precompute a lookup table for all possible differences (0‚Äì255 for each channel, or squared Euclidean differences 0‚Äì195075) in
the RGB color space because it is small enough to store.</p><p>See the corresponding information block for CIELAB to see why this differs between the color spaces.</p></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="on-the-fly-cielab-range-weights">&quot;On the Fly&quot; CIELAB Range Weights<a href="#on-the-fly-cielab-range-weights" class="hash-link" aria-label="Direct link to &quot;On the Fly&quot; CIELAB Range Weights" title="Direct link to &quot;On the Fly&quot; CIELAB Range Weights" translate="no">‚Äã</a></h4>
<p>In the CIELAB color space, the pixels are not bounded <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>255</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,255]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">255</span><span class="mclose">]</span></span></span></span> per channel like RGB.
Thus, we calculate the <code>similarity score</code> for every possible color difference as we need them during the main body of the bilateral filter (&quot;on the fly&quot;).</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">w_range </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">gaussian</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dist</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sigma_range</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>&quot;On the fly&quot; vs. LUT</div><div class="admonitionContent_BuS1"><p>In <strong>CIELAB</strong>, the pixels are not bounded 0‚Äì255 per channel in the same way:</p><ul>
<li class="">L: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>100</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,100]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">100</span><span class="mclose">]</span></span></span></span></li>
<li class="">a: roughly <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo>‚àí</mo><mn>128</mn><mo separator="true">,</mo><mn>127</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[‚àí128,127]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord">‚àí</span><span class="mord">128</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">127</span><span class="mclose">]</span></span></span></span></li>
<li class="">b: roughly <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mo>‚àí</mo><mn>128</mn><mo separator="true">,</mo><mn>127</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[‚àí128,127]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord">‚àí</span><span class="mord">128</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">127</span><span class="mclose">]</span></span></span></span></li>
</ul><p>But more importantly:</p><ol>
<li class=""><strong>Continuous values:</strong> After conversion from RGB, the values are floating-point.
The differences (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">‚à£</mi><msup><mi>L</mi><mo>‚àó</mo></msup><msup><mi>a</mi><mo>‚àó</mo></msup><msup><mi>b</mi><mo>‚àó</mo></msup><mo>‚àí</mo><msup><mi>L</mi><mo>‚àó</mo></msup><msup><mi>a</mi><mo>‚àó</mo></msup><msup><mi>b</mi><mo>‚àó</mo></msup><msup><mi mathvariant="normal">‚à£</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">|L^*a^*b^* - L^*a^*b^*|^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord">‚à£</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">‚àó</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">‚àó</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">‚àó</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">‚àó</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">‚àó</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6887em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">‚àó</span></span></span></span></span></span></span></span><span class="mord"><span class="mord">‚à£</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em"><span style="top:-3.063em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>) are continuous, not integers.
So the LUT would need to store <strong>all possible floating-point differences</strong>, which is essentially impossible.</li>
<li class=""><strong>Large dynamic range:</strong> The squared Euclidean distance in Lab can be <strong>much larger than in 8-bit RGB</strong>, especially when using floating-point precision.
Precomputing a LUT with sufficient precision would be huge.</li>
<li class=""><strong>Precision matters:</strong> Small errors in range weights in Lab are more noticeable because the filter is very sensitive to perceptual color distances.
A coarse LUT could lead to visible artifacts.</li>
</ol></div></div>
<details open="" class="details_lb9f alert alert--info details_b_Ee" data-collapsed="false"><summary><h4>RGB LUT vs CIELAB On-the-Fly Weights</h4></summary><div><div class="collapsibleContent_i85q"><p>Bilateral filtering computes a <strong>range weight</strong> for each pixel in the kernel based on the color difference between the center pixel and its neighbor.</p><div style="display:flex;flex-direction:column;justify-content:center;align-items:center"><svg style="width:100%;max-width:500px" viewBox="0 0 430 150" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="100%" height="100%" fill="#fff"></rect><path d="M10,10 L13,10.062460953770952 L16,10.249376040365881 L19,10.559347769438347 L22,10.990066334662238 L25,11.538338276182792 L28,12.200125908345 L31,12.970596831782899 L34,13.844182680668212 L37,14.814646106340199 L40,15.875154870770224 L43,17.018361819872887 L46,18.236489429436403 L49,19.521417566605656 L52,20.864773087906592 L55,22.258019900549634 L58,23.692548146315453 L61,25.15976122519826 L64,26.651159457076282 L67,28.15841928141284 L70,29.673467014368327 L73,31.188546316410005 L76,32.69627866801453 L79,34.18971630272519 L82,35.66238720200141 L85,37.108331911419285 L88,38.52213208946304 L91,39.89893084526726 L94,41.23444505743002 L97,42.524969990012174 L100,43.76737663208252 L103,44.95910228213622 L106,46.098134977340294 L109,47.18299242924632 L112,48.212696172206826 L115,49.18674165850564 L118,50.105065045819266 L121,50.9680074190553 L124,51.776277171142254 L127,52.5309112374791 L130,53.233235838169364 L133,53.88482733265497 L136,54.48747373477574 L139,55.04313737446263 L142,55.55391912703068 L145,56.02202456408862 L148,56.44973231301815 L151,56.839364846235554 L154,57.19326185829331 L157,57.51375632938252 L160,57.80315331882963 L163,58.063711482416785 L166,58.29762726327003 L169,58.50702166794422 L172,58.69392950730409 L175,58.86029095581938 L178,59.00794526278148 L181,59.13862643441824 L184,59.253960696546606 L187,59.35546554279993 L190,59.44455017308788 L193,59.522517130248985 L196,59.590564949281294 L199,59.64979164253188 L202,59.7011988552497 L205,59.745696538449366 L208,59.78410799961835 L211,59.81717520599736 L214,59.84556422958816 L217,59.86987073736373 L220,59.89062544409086 L223,59.908299458496344 L226,59.92330946603378 L229,59.936022703105 L232,59.9467616881666 L235,59.95580868465325 L238,59.96340987905597 L241,59.969779264812026 L244,59.97510222892484 L247,59.97953884348859 L250,59.98322686860487 L253,59.98628447662533 L256,59.98881271031397 L259,59.99089768948165 L262,59.992612581988396 L265,59.994019355820946 L268,59.99517032931389 L271,59.99610953656922 L274,59.99687392481126 L277,59.99749439985569 L280,59.99799673513035 L283,59.998402358811276 L286,59.99872903267419 L289,59.998991435246175 L292,59.99920166080511 L295,59.99936964474115 L298,59.99950352478471 L301,59.999609946634884 L304,59.99969432160168 L307,59.99976104301339 L310,59.9998136673414 L310,60 L10,60 Z" fill="rgba(255,107,107,0.3)" stroke="#ff6b6b" stroke-width="2"></path><path d="M10,70 L13,70.11098774571968 L16,70.44247497558575 L19,70.99006633466223 L22,71.74654411051597 L25,72.70202655466173 L28,73.84418268066821 L31,75.15849701265657 L34,76.62857634082945 L37,78.2364894294364 L40,79.9631298541596 L43,81.78859174142548 L46,83.69254814631546 L49,85.65462212713061 L52,87.65474122678239 L55,89.67346701436833 L58,91.69229252414013 L61,93.69390179532718 L64,95.66238720200141 L67,97.58342180295284 L70,99.44438547464063 L73,101.23444505743002 L76,102.9445900951704 L79,104.56762693816906 L82,106.0981349773403 L85,107.53238956113519 L88,108.86825670605545 L91,110.10506504581927 L94,111.24346058274244 L97,112.28524972492158 L100,113.23323583816936 L103,114.09105414091097 L106,114.86300925487528 L109,115.55391912703068 L112,116.16896839097532 L115,116.71357356917348 L118,117.19326185829331 L121,117.6135646118418 L124,117.97992605629184 L127,118.29762726327003 L130,118.57172496077249 L133,118.80700440603098 L136,119.00794526278149 L139,119.17869922405572 L142,119.32307799316739 L145,119.44455017308789 L148,119.54624560921742 L151,119.63096577311629 L154,119.7011988552497 L157,119.75913834359469 L160,119.80670399302636 L163,119.84556422958816 L166,119.87715917697554 L169,119.9027236339267 L172,119.92330946603377 L175,119.9398070002586 L178,119.95296512275661 L181,119.96340987905597 L184,119.97166145962566 L187,119.97814952350501 L190,119.98322686860487 L193,119.98718150056972 L196,119.99024718401594 L199,119.9926125819884 L202,119.99442910311186 L205,119.99581758263851 L208,119.99687392481125 L211,119.99767383095237 L214,119.99827673158514 L217,119.99872903267419 L220,119.99906677654432 L223,119.99931780786491 L226,119.99950352478471 L229,119.99964028525542 L232,119.99974052906967 L235,119.9998136673414 L238,119.99986678318247 L241,119.9999051802228 L244,119.99993280938612 L247,119.99995259893606 L250,119.99996670819264 L253,119.99997672142142 L256,119.99998379513767 L259,119.99998876937217 L262,119.99999225123432 L265,119.99999467731429 L268,119.99999636002065 L271,119.99999752179734 L274,119.9999983202505 L277,119.9999988664987 L280,119.99999923850102 L283,119.99999949068503 L286,119.99999966086442 L289,119.99999977518253 L292,119.99999985162641 L295,119.9999999025116 L298,119.99999993622961 L301,119.99999995847067 L304,119.9999999730747 L307,119.99999998262054 L310,119.99999998883185 L310,120 L10,120 Z" fill="rgba(77,171,247,0.2)" stroke="#4dabf7" stroke-width="2"></path><text x="200" y="50" font-size="12" fill="#ff6b6b">RGB LUT</text><text x="200" y="110" font-size="12" fill="#4dabf7">CIELAB (on-the-fly)</text><line x1="10" y1="60" x2="310" y2="60" stroke="#000" stroke-width="0.5"></line><line x1="10" y1="120" x2="310" y2="120" stroke="#000" stroke-width="0.5"></line><text x="320" y="65" font-size="10">Color difference ŒîRGB</text><text x="320" y="125" font-size="10">Color difference ŒîLAB</text></svg><sub>Above, œÉ<sub>r</sub> = 20 for RGB and œÉ<sub>r</sub> = 15 for CIELAB.</sub></div><h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="rgb-lut-red-curve-and-shaded-area">RGB LUT (Red curve and shaded area)<a href="#rgb-lut-red-curve-and-shaded-area" class="hash-link" aria-label="Direct link to RGB LUT (Red curve and shaded area)" title="Direct link to RGB LUT (Red curve and shaded area)" translate="no">‚Äã</a></h5><p>In the RGB color space, the maximum possible color difference is limited (0‚Äì255 per channel).
This allows us to <strong>precompute all possible weights</strong> in a <strong>Lookup Table (LUT)</strong>.
During filtering, we simply <strong>look up the weight</strong> instead of recomputing it with
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>exp</mi><mo>‚Å°</mo><mrow><mo fence="true">(</mo><mo>‚àí</mo><mfrac><msup><mi>x</mi><mn>2</mn></msup><mrow><mn>2</mn><msubsup><mi>œÉ</mi><mrow><mi>s</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>a</mi><mi>l</mi></mrow><mn>2</mn></msubsup></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\exp\left(-\frac{x^2}{2\sigma_{spatial}^2}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.8639em;vertical-align:-0.7139em"></span><span class="mop">exp</span><span class="mspace" style="margin-right:0.1667em"></span><span class="minner"><span class="mopen delimcenter" style="top:0em"><span class="delimsizing size2">(</span></span><span class="mord">‚àí</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0179em"><span style="top:-2.6264em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em">œÉ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em"><span style="top:-2.1528em;margin-left:-0.0359em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ia</span><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span></span></span></span><span style="top:-2.8448em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.4861em"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:0.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em"><span style="top:-2.931em;margin-right:0.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.7139em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em"><span class="delimsizing size2">)</span></span></span></span></span></span>
for each neighbor.
The discrete nature of the LUT is represented by the shaded area and the curve shows how weight decays with increasing ŒîRGB.</p><h5 class="anchor anchorTargetStickyNavbar_Vzrq" id="cielab-blue-curve-and-shaded-area">CIELAB (Blue curve and shaded area)<a href="#cielab-blue-curve-and-shaded-area" class="hash-link" aria-label="Direct link to CIELAB (Blue curve and shaded area)" title="Direct link to CIELAB (Blue curve and shaded area)" translate="no">‚Äã</a></h5><p>In the CIELAB color space, the number of possible differences is much larger and continuous.
Precomputing a LUT would require enormous memory, so weights are <strong>computed on-the-fly</strong>.
The curve represents the weight for a given color difference ŒîLAB, and the shaded area illustrates the range of influence.</p><div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>This visual shows why RGB weights can be precomputed while CIELAB weights must be computed dynamically.
The <strong>height of the curve/area corresponds to the weight</strong> given by the Gaussian function: higher means more influence in the filtered pixel.</p></div></div></div></div></details>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-sliding-window-loop">3. Sliding Window Loop<a href="#3-sliding-window-loop" class="hash-link" aria-label="Direct link to 3. Sliding Window Loop" title="Direct link to 3. Sliding Window Loop" translate="no">‚Äã</a></h2>
<p>The core processing happens in a nested loop over every pixel <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(y, x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>. For each pixel, we:</p>
<ol>
<li class=""><strong>Iterate</strong> over the window from <code>-radius</code> to <code>+radius</code> (from left to right inside the effective circular range and domain of the kernel).</li>
<li class=""><strong>Fetch</strong> neighbor RGB values.</li>
<li class=""><strong>Calculate</strong> color difference using squared Euclidean distance.</li>
<li class=""><strong>Lookup weights:</strong>
<ul>
<li class=""><strong>Spatial weights:</strong> Precomputed at the start of the bilateral filter.</li>
<li class=""><strong>Range weights:</strong>
<ul>
<li class=""><em>RGB</em>: From LUT (precomputed at the start of the bilateral filter).</li>
<li class=""><em>CIELAB</em>: Calculate &quot;on the fly&quot;.</li>
</ul>
</li>
</ul>
</li>
<li class=""><strong>Accumulate</strong> the weighted sum and the sum of weights.</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-normalization">4. Normalization<a href="#4-normalization" class="hash-link" aria-label="Direct link to 4. Normalization" title="Direct link to 4. Normalization" translate="no">‚Äã</a></h2>
<p>Finally, we normalize the accumulated color values by the total weight (clamped to valid RGB values: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>0</mn><mo separator="true">,</mo><mn>255</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[0,255]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord">255</span><span class="mclose">]</span></span></span></span>) to get the filtered pixel value:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">center_idx</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#d73a49">static_cast</span><span class="token generic-function generic class-name operator" style="color:#393A34">&lt;</span><span class="token generic-function generic class-name keyword" style="color:#00009f">uint8_t</span><span class="token generic-function generic class-name operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">clamp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r_acc </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> weight_acc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">255.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>This ensures the pixel brightness remains consistent with the local area.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/Ryan-Millard/Img2Num/edit/main/docs/docs/reference/wasm/modules/image/bilateral_filter/implementation.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/overview/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Img2Num/info/docs/reference/wasm/modules/image/bilateral_filter/api/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">API / Usage</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-parameters--kernel-size" class="table-of-contents__link toc-highlight">1. Parameters &amp; Kernel Size</a></li><li><a href="#2-computing-weights" class="table-of-contents__link toc-highlight">2. Computing Weights</a><ul><li><a href="#spatial-weights-constant-per-kernel" class="table-of-contents__link toc-highlight">Spatial Weights (constant per kernel)</a></li><li><a href="#range-weights" class="table-of-contents__link toc-highlight">Range Weights</a></li></ul></li><li><a href="#3-sliding-window-loop" class="table-of-contents__link toc-highlight">3. Sliding Window Loop</a></li><li><a href="#4-normalization" class="table-of-contents__link toc-highlight">4. Normalization</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Img2Num/info/docs/">Documentation</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/Ryan-Millard/Img2Num/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Img2Num/info/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/Ryan-Millard/Img2Num" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2026 Img2Num.</div></div></div></footer></div>
</body>
</html>