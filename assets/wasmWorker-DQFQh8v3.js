(function(){"use strict";async function ee(d={}){var k,t=d,P=self.location.href,_="";function B(e){return t.locateFile?t.locateFile(e,_):_+e}var l;{try{_=new URL(".",P).href}catch{}l=async e=>{var r=await fetch(e,{credentials:"same-origin"});if(r.ok)return r.arrayBuffer();throw new Error(r.status+" : "+r.url)}}console.log.bind(console);var w=console.error.bind(console),b,S=!1,F,m,v,f,h,C,H,g,E,W,j,$=!1;function z(){var e=v.buffer;f=new Int8Array(e),C=new Int16Array(e),t.HEAPU8=h=new Uint8Array(e),H=new Int32Array(e),g=new Uint32Array(e),E=new Float32Array(e),W=new Float64Array(e),j=new BigInt64Array(e),new BigUint64Array(e)}function te(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)me(t.preRun.shift());D(K)}function ne(){$=!0,U.f()}function ae(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)ve(t.postRun.shift());D(L)}function T(e){t.onAbort?.(e),e="Aborted("+e+")",w(e),S=!0,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw m?.(r),r}var V;function ie(){return t.locateFile?B("index.wasm"):new URL("/Img2Num/assets/index-BuM9qH_e.wasm",self.location.href).href}function se(e){if(e==V&&b)return new Uint8Array(b);throw"both async and sync fetching of the wasm failed"}async function oe(e){if(!b)try{var r=await l(e);return new Uint8Array(r)}catch{}return se(e)}async function ce(e,r){try{var n=await oe(e),a=await WebAssembly.instantiate(n,r);return a}catch(o){w(`failed to asynchronously prepare wasm: ${o}`),T(o)}}async function fe(e,r,n){if(!e)try{var a=fetch(r,{credentials:"same-origin"}),o=await WebAssembly.instantiateStreaming(a,n);return o}catch(s){w(`wasm streaming compile failed: ${s}`),w("falling back to ArrayBuffer instantiation")}return ce(r,n)}function ue(){return{a:je}}async function le(){function e(s,i){return U=s.exports,v=U.e,z(),We(U),U}function r(s){return e(s.instance)}var n=ue();if(t.instantiateWasm)return new Promise((s,i)=>{t.instantiateWasm(n,(c,R)=>{s(e(c))})});V??=ie();var a=await fe(b,V,n),o=r(a);return o}var D=e=>{for(;e.length>0;)e.shift()(t)},L=[],ve=e=>L.push(e),K=[],me=e=>K.push(e);function ge(e,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":return f[e];case"i8":return f[e];case"i16":return C[e>>1];case"i32":return H[e>>2];case"i64":return j[e>>3];case"float":return E[e>>2];case"double":return W[e>>3];case"*":return g[e>>2];default:T(`invalid type for getValue: ${r}`)}}function _e(e,r,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":f[e]=r;break;case"i8":f[e]=r;break;case"i16":C[e>>1]=r;break;case"i32":H[e>>2]=r;break;case"i64":j[e>>3]=BigInt(r);break;case"float":E[e>>2]=r;break;case"double":W[e>>3]=r;break;case"*":g[e>>2]=r;break;default:T(`invalid type for setValue: ${n}`)}}var he=e=>Z(e),ye=()=>G();class de{constructor(r){this.excPtr=r,this.ptr=r-24}set_type(r){g[this.ptr+4>>2]=r}get_type(){return g[this.ptr+4>>2]}set_destructor(r){g[this.ptr+8>>2]=r}get_destructor(){return g[this.ptr+8>>2]}set_caught(r){r=r?1:0,f[this.ptr+12]=r}get_caught(){return f[this.ptr+12]!=0}set_rethrown(r){r=r?1:0,f[this.ptr+13]=r}get_rethrown(){return f[this.ptr+13]!=0}init(r,n){this.set_adjusted_ptr(0),this.set_type(r),this.set_destructor(n)}set_adjusted_ptr(r){g[this.ptr+16>>2]=r}get_adjusted_ptr(){return g[this.ptr+16>>2]}}var O=0,we=(e,r,n)=>{var a=new de(e);throw a.init(r,n),O=e,O},be=()=>T(""),Re=()=>Date.now(),Ae=()=>2147483648,pe=(e,r)=>Math.ceil(e/r)*r,ke=e=>{var r=v.buffer.byteLength,n=(e-r+65535)/65536|0;try{return v.grow(n),z(),1}catch{}},Pe=e=>{var r=h.length;e>>>=0;var n=Ae();if(e>n)return!1;for(var a=1;a<=4;a*=2){var o=r*(1+.2/a);o=Math.min(o,e+100663296);var s=Math.min(n,pe(Math.max(e,o),65536)),i=ke(s);if(i)return!0}return!1},J=e=>{var r=t["_"+e];return r},Ue=(e,r)=>{f.set(e,r)},Be=e=>{for(var r=0,n=0;n<e.length;++n){var a=e.charCodeAt(n);a<=127?r++:a<=2047?r+=2:a>=55296&&a<=57343?(r+=4,++n):r+=3}return r},Fe=(e,r,n,a)=>{if(!(a>0))return 0;for(var o=n,s=n+a-1,i=0;i<e.length;++i){var c=e.codePointAt(i);if(c<=127){if(n>=s)break;r[n++]=c}else if(c<=2047){if(n+1>=s)break;r[n++]=192|c>>6,r[n++]=128|c&63}else if(c<=65535){if(n+2>=s)break;r[n++]=224|c>>12,r[n++]=128|c>>6&63,r[n++]=128|c&63}else{if(n+3>=s)break;r[n++]=240|c>>18,r[n++]=128|c>>12&63,r[n++]=128|c>>6&63,r[n++]=128|c&63,i++}}return r[n]=0,n-o},Me=(e,r,n)=>Fe(e,h,r,n),Q=e=>q(e),Se=e=>{var r=Be(e)+1,n=Q(r);return Me(e,n,r),n},X=typeof TextDecoder<"u"?new TextDecoder:void 0,Te=(e,r,n,a)=>{for(var o=r+n;e[r]&&!(r>=o);)++r;return r},Ce=(e,r=0,n,a)=>{var o=Te(e,r,n);if(o-r>16&&e.buffer&&X)return X.decode(e.subarray(r,o));for(var s="";r<o;){var i=e[r++];if(!(i&128)){s+=String.fromCharCode(i);continue}var c=e[r++]&63;if((i&224)==192){s+=String.fromCharCode((i&31)<<6|c);continue}var R=e[r++]&63;if((i&240)==224?i=(i&15)<<12|c<<6|R:i=(i&7)<<18|c<<12|R<<6|e[r++]&63,i<65536)s+=String.fromCharCode(i);else{var A=i-65536;s+=String.fromCharCode(55296|A>>10,56320|A&1023)}}return s},He=(e,r,n)=>e?Ce(h,e,r):"",Y=(e,r,n,a,o)=>{var s={string:u=>{var M=0;return u!=null&&u!==0&&(M=Se(u)),M},array:u=>{var M=Q(u.length);return Ue(u,M),M}};function i(u){return r==="string"?He(u):r==="boolean"?!!u:u}var c=J(e),R=[],A=0;if(a)for(var p=0;p<a.length;p++){var x=s[n[p]];x?(A===0&&(A=ye()),R[p]=x(a[p])):R[p]=a[p]}var I=c(...R);function Ie(u){return A!==0&&he(A),i(u)}return I=Ie(I),I},Ee=(e,r,n,a)=>{var o=!n||n.every(i=>i==="number"||i==="boolean"),s=r!=="string";return s&&o&&!a?J(e):(...i)=>Y(e,r,n,i)};if(t.noExitRuntime&&t.noExitRuntime,t.print&&t.print,t.printErr&&(w=t.printErr),t.wasmBinary&&(b=t.wasmBinary),t.arguments&&t.arguments,t.thisProgram&&t.thisProgram,t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.shift()();t.ccall=Y,t.cwrap=Ee,t.setValue=_e,t.getValue=ge;var Z,q,G;function We(e){t._gaussian_blur_fft=e.g,t._invert_image=e.h,t._threshold_image=e.i,t._black_threshold_image=e.j,t._kmeans_clustering=e.k,t._kmeans_clustering_spatial=e.l,t._mergeSmallRegionsInPlace=e.m,t._malloc=e.n,t._free=e.o,Z=e.p,q=e.q,G=e.r}var je={a:we,b:be,d:Re,c:Pe};function Ve(){te();function e(){t.calledRun=!0,!S&&(ne(),F?.(t),t.onRuntimeInitialized?.(),ae())}t.setStatus?(t.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>t.setStatus(""),1),e()},1)):e()}var U;return U=await le(),Ve(),$?k=t:k=new Promise((e,r)=>{F=e,m=r}),k}let y,N;const re=new Promise(d=>N=d);ee().then(d=>{y=d,N()}),self.onmessage=async({data:d})=>{await re;const{id:k,funcName:t,args:P,bufferKeys:_}=d,B={};try{if(_)for(const m of _){const v=P[m],f=v.length,h=y._malloc(f);y.HEAPU8.set(v,h),B[m]={ptr:h,size:f},P[m]=h}const l=`_${t}`;if(typeof y[l]!="function")throw new Error(`WASM export not found: ${l}`);const w=y[l],b=t&&P?Object.values(P):[],S=w(...b),F={};if(_)for(const m of _){const{ptr:v,size:f}=B[m];F[m]=new Uint8ClampedArray(y.HEAPU8.subarray(v,v+f))}self.postMessage({id:k,output:F,returnValue:S})}catch(l){self.postMessage({id:k,error:l.message})}finally{for(const{ptr:l}of Object.values(B))y._free(l)}}})();
