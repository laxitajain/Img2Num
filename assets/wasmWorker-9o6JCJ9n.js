(function(){"use strict";async function _e(M={}){var S,n=M,E=typeof window=="object",A=typeof WorkerGlobalScope<"u";typeof process=="object"&&process.versions?.node&&process.type!="renderer";var d=A&&self.name?.startsWith("em-pthread"),k=(e,r)=>{throw r},D=self.location.href,N="";function Z(e){return n.locateFile?n.locateFile(e,N):N+e}var P,_;if(E||A){try{N=new URL(".",D).href}catch{}A&&(_=e=>{var r=new XMLHttpRequest;return r.open("GET",e,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}),P=async e=>{var r=await fetch(e,{credentials:"same-origin"});if(r.ok)return r.arrayBuffer();throw new Error(r.status+" : "+r.url)}}var m=console.log.bind(console),v=console.error.bind(console),h,H,O=!1,B;function f(){T.buffer!=w.buffer&&V()}var q,pe,ye;if(d){let e=function(r){try{var t=r.data,i=t.cmd;if(i==="load"){let o=[];self.onmessage=s=>o.push(s),ye=()=>{postMessage({cmd:"loaded"});for(let s of o)e(s);self.onmessage=e};for(const s of t.handlers)(!n[s]||n[s].proxy)&&(n[s]=(...a)=>{postMessage({cmd:"callHandler",handler:s,args:a})},s=="print"&&(m=n[s]),s=="printErr"&&(v=n[s]));T=t.wasmMemory,V(),H=t.wasmModule,ke(),G()}else if(i==="run"){wr(t.pthread_ptr),de(t.pthread_ptr,0,0,1,0,0),u.threadInitTLS(),le(t.pthread_ptr),J||(J=!0);try{Ar(t.start_routine,t.arg)}catch(o){if(o!="unwind")throw o}}else t.target==="setimmediate"||(i==="checkMailbox"?J&&Y():i&&(v(`worker: received unknown command ${i}`),v(t)))}catch(o){throw Qe(),o}};var J=!1;self.onunhandledrejection=r=>{throw r.reason||r},self.onmessage=e}var T,w,F,ee,L,p,re,C,W,ge=!1,te=!1;function V(){var e=T.buffer;w=new Int8Array(e),ee=new Int16Array(e),n.HEAPU8=F=new Uint8Array(e),n.HEAP32=L=new Int32Array(e),p=new Uint32Array(e),re=new Float32Array(e),C=new Float64Array(e),W=new BigInt64Array(e),new BigUint64Array(e)}function or(){if(!d){if(n.wasmMemory)T=n.wasmMemory;else{var e=n.INITIAL_MEMORY||1073741824;T=new WebAssembly.Memory({initial:e/65536,maximum:32768,shared:!0})}V()}}function fr(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)Ee(n.preRun.shift());We(Me)}function we(){if(ge=!0,d)return ye();U.r()}function lr(){d||(Xe(),Kr(),u.terminateAllThreads(),te=!0)}function ur(){if(!d){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)gr(n.postRun.shift());We(Be)}}function x(e){n.onAbort?.(e),e="Aborted("+e+")",v(e),O=!0,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw pe?.(r),r}var ne;function cr(){return n.locateFile?Z("index.wasm"):new URL("/Img2Num/assets/index-Xv34nsE8.wasm",self.location.href).href}function dr(e){if(e==ne&&h)return new Uint8Array(h);if(_)return _(e);throw"both async and sync fetching of the wasm failed"}async function vr(e){if(!h)try{var r=await P(e);return new Uint8Array(r)}catch{}return dr(e)}async function mr(e,r){try{var t=await vr(e),i=await WebAssembly.instantiate(t,r);return i}catch(o){v(`failed to asynchronously prepare wasm: ${o}`),x(o)}}async function _r(e,r,t){if(!e)try{var i=fetch(r,{credentials:"same-origin"}),o=await WebAssembly.instantiateStreaming(i,t);return o}catch(s){v(`wasm streaming compile failed: ${s}`),v("falling back to ArrayBuffer instantiation")}return mr(r,t)}function be(){return nt(),{a:nr}}async function ke(){function e(a,l){return U=a.exports,Tr(U.A),Ne=U.t,H=l,tt(U),U}function r(a){return e(a.instance,a.module)}var t=be();if(n.instantiateWasm)return new Promise((a,l)=>{n.instantiateWasm(t,(c,y)=>{a(e(c,y))})});if(d){var i=new WebAssembly.Instance(H,be());return e(i,H)}ne??=cr();var o=await _r(h,ne,t),s=r(o);return s}class Ae{name="ExitStatus";constructor(r){this.message=`Program terminated with exit(${r})`,this.status=r}}var Te=e=>{e.terminate(),e.onmessage=r=>{}},Re=e=>{var r=u.pthreads[e];u.returnWorkerToPool(r)},We=e=>{for(;e.length>0;)e.shift()(n)},Me=[],Ee=e=>Me.push(e),I=0,j=null,hr=e=>{if(I--,n.monitorRunDependencies?.(I),I==0&&j){var r=j;j=null,r()}},pr=e=>{I++,n.monitorRunDependencies?.(I)},Pe=e=>{var r=u.getNewWorker();if(!r)return 6;u.runningWorkers.push(r),u.pthreads[e.pthread_ptr]=r,r.pthread_ptr=e.pthread_ptr;var t={cmd:"run",start_routine:e.startRoutine,arg:e.arg,pthread_ptr:e.pthread_ptr};return r.postMessage(t,e.transferList),0},ae=0,z=()=>fe||ae>0,Ie=()=>tr(),ie=e=>er(e),se=e=>rr(e),K=(e,r,t,...i)=>{for(var o=i.length*2,s=Ie(),a=se(o*8),l=a>>3,c=0;c<i.length;c++){var y=i[c];typeof y=="bigint"?((f(),W)[l+2*c]=1n,(f(),W)[l+2*c+1]=y):((f(),W)[l+2*c]=0n,(f(),C)[l+2*c+1]=y)}var R=De(e,r,o,a,t);return ie(s),R};function Ue(e){if(d)return K(0,0,1,e);B=e,z()||(u.terminateAllThreads(),n.onExit?.(e),O=!0),k(e,new Ae(e))}function Se(e){if(d)return K(1,0,0,e);oe(e)}var yr=(e,r)=>{if(B=e,d)throw Se(e),"unwind";z()||lr(),Ue(e)},oe=yr,u={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init(){d||u.initMainThread()},initMainThread(){for(var e=8;e--;)u.allocateUnusedWorker();Ee(async()=>{var r=u.loadWasmModuleToAllWorkers();pr(),await r,hr()})},terminateAllThreads:()=>{for(var e of u.runningWorkers)Te(e);for(var e of u.unusedWorkers)Te(e);u.unusedWorkers=[],u.runningWorkers=[],u.pthreads={}},returnWorkerToPool:e=>{var r=e.pthread_ptr;delete u.pthreads[r],u.unusedWorkers.push(e),u.runningWorkers.splice(u.runningWorkers.indexOf(e),1),e.pthread_ptr=0,Ze(r)},threadInitTLS(){u.tlsInitFunctions.forEach(e=>e())},loadWasmModuleToWorker:e=>new Promise(r=>{e.onmessage=s=>{var a=s.data,l=a.cmd;if(a.targetThread&&a.targetThread!=Q()){var c=u.pthreads[a.targetThread];c?c.postMessage(a,a.transferList):v(`Internal error! Worker sent a message "${l}" to target pthread ${a.targetThread}, but that thread no longer exists!`);return}l==="checkMailbox"?Y():l==="spawnThread"?Pe(a):l==="cleanupThread"?$e(()=>Re(a.thread)):l==="loaded"?(e.loaded=!0,r(e)):a.target==="setimmediate"?e.postMessage(a):l==="callHandler"?n[a.handler](...a.args):l&&v(`worker sent an unknown command ${l}`)},e.onerror=s=>{var a="worker sent an error!";throw v(`${a} ${s.filename}:${s.lineno}: ${s.message}`),s};var t=[],i=["onExit","onAbort","print","printErr"];for(var o of i)n.propertyIsEnumerable(o)&&t.push(o);e.postMessage({cmd:"load",handlers:t,wasmMemory:T,wasmModule:H})}),async loadWasmModuleToAllWorkers(){return d?void 0:Promise.all(u.unusedWorkers.map(u.loadWasmModuleToWorker))},allocateUnusedWorker(){var e;if(n.mainScriptUrlOrBlob){var r=n.mainScriptUrlOrBlob;typeof r!="string"&&(r=URL.createObjectURL(r)),e=new Worker(r,{type:"module",name:"em-pthread"})}else e=new Worker(new URL("/Img2Num/assets/index-R_Qmsn5R.js",self.location.href),{type:"module",name:"em-pthread"});u.unusedWorkers.push(e)},getNewWorker(){return u.unusedWorkers.length==0&&(u.allocateUnusedWorker(),u.loadWasmModuleToWorker(u.unusedWorkers[0])),u.unusedWorkers.pop()}},Be=[],gr=e=>Be.push(e);function wr(e){var r=(f(),p)[e+52>>2],t=(f(),p)[e+56>>2],i=r-t;Je(r,i),ie(r)}function br(e,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":return(f(),w)[e];case"i8":return(f(),w)[e];case"i16":return(f(),ee)[e>>1];case"i32":return(f(),L)[e>>2];case"i64":return(f(),W)[e>>3];case"float":return(f(),re)[e>>2];case"double":return(f(),C)[e>>3];case"*":return(f(),p)[e>>2];default:x(`invalid type for getValue: ${r}`)}}var Fe=[],Ne,kr=e=>{var r=Fe[e];return r||(Fe[e]=r=Ne.get(e)),r},Ar=(e,r)=>{ae=0,fe=0;var t=kr(e)(r);function i(o){if(z()){B=o;return}ve(o)}i(t)},fe=!1,Tr=e=>u.tlsInitFunctions.push(e);function Rr(e,r,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":(f(),w)[e]=r;break;case"i8":(f(),w)[e]=r;break;case"i16":(f(),ee)[e>>1]=r;break;case"i32":(f(),L)[e>>2]=r;break;case"i64":(f(),W)[e>>3]=BigInt(r);break;case"float":(f(),re)[e>>2]=r;break;case"double":(f(),C)[e>>3]=r;break;case"*":(f(),p)[e>>2]=r;break;default:x(`invalid type for setValue: ${t}`)}}class Wr{constructor(r){this.excPtr=r,this.ptr=r-24}set_type(r){(f(),p)[this.ptr+4>>2]=r}get_type(){return(f(),p)[this.ptr+4>>2]}set_destructor(r){(f(),p)[this.ptr+8>>2]=r}get_destructor(){return(f(),p)[this.ptr+8>>2]}set_caught(r){r=r?1:0,(f(),w)[this.ptr+12]=r}get_caught(){return(f(),w)[this.ptr+12]!=0}set_rethrown(r){r=r?1:0,(f(),w)[this.ptr+13]=r}get_rethrown(){return(f(),w)[this.ptr+13]!=0}init(r,t){this.set_adjusted_ptr(0),this.set_type(r),this.set_destructor(t)}set_adjusted_ptr(r){(f(),p)[this.ptr+16>>2]=r}get_adjusted_ptr(){return(f(),p)[this.ptr+16>>2]}}var He=0,Mr=(e,r,t)=>{var i=new Wr(e);throw i.init(r,t),He=e,He};function Le(e,r,t,i){return d?K(2,0,1,e,r,t,i):Ce(e,r,t,i)}var Er=()=>typeof SharedArrayBuffer<"u",Ce=(e,r,t,i)=>{if(!Er())return 6;var o=[],s=0;if(d&&(o.length===0||s))return Le(e,r,t,i);var a={startRoutine:t,pthread_ptr:e,arg:i,transferList:o};return d?(a.cmd="spawnThread",postMessage(a,o),0):Pe(a)},Pr=()=>x(""),Ir=e=>{de(e,!A,1,!E,65536,!1),u.threadInitTLS()},je=e=>{if(e instanceof Ae||e=="unwind")return B;k(1,e)},Ur=()=>{if(!te&&!z())try{if(d){Q()&&ve(B);return}oe(B)}catch(e){je(e)}},$e=e=>{if(!(te||O))try{e(),Ur()}catch(r){je(r)}},le=e=>{if(typeof Atomics.waitAsync=="function"){var r=Atomics.waitAsync((f(),L),e>>2,e);r.value.then(Y);var t=e+128;Atomics.store((f(),L),t>>2,1)}},Y=()=>$e(()=>{var e=Q();e&&(le(e),qe())}),Sr=(e,r)=>{if(e==r)setTimeout(Y);else if(d)postMessage({targetThread:e,cmd:"checkMailbox"});else{var t=u.pthreads[e];if(!t)return;t.postMessage({cmd:"checkMailbox"})}},X=[],Br=(e,r,t,i,o)=>{i/=2,X.length=i;for(var s=o>>3,a=0;a<i;a++)(f(),W)[s+2*a]?X[a]=(f(),W)[s+2*a+1]:X[a]=(f(),C)[s+2*a+1];var l=rt[e];u.currentProxiedOperationCallerThread=t;var c=l(...X);return u.currentProxiedOperationCallerThread=0,c},Fr=e=>{d?postMessage({cmd:"cleanupThread",thread:e}):Re(e)},Nr=e=>{},Hr=()=>performance.timeOrigin+performance.now(),Lr=()=>{},Cr=()=>{ae+=1},jr=()=>{throw Cr(),"unwind"},$r=()=>2147483648,Or=(e,r)=>Math.ceil(e/r)*r,Vr=e=>{var r=T.buffer.byteLength,t=(e-r+65535)/65536|0;try{return T.grow(t),V(),1}catch{}},xr=e=>{var r=(f(),F).length;if(e>>>=0,e<=r)return!1;var t=$r();if(e>t)return!1;for(var i=1;i<=4;i*=2){var o=r*(1+.2/i);o=Math.min(o,e+100663296);var s=Math.min(t,Or(Math.max(e,o),65536)),a=Vr(s);if(a)return!0}return!1},ue=[null,[],[]],Oe=typeof TextDecoder<"u"?new TextDecoder:void 0,zr=(e,r,t,i)=>{for(var o=r+t;e[r]&&!(r>=o);)++r;return r},Ve=(e,r=0,t,i)=>{var o=zr(e,r,t);if(o-r>16&&e.buffer&&Oe)return Oe.decode(e.buffer instanceof ArrayBuffer?e.subarray(r,o):e.slice(r,o));for(var s="";r<o;){var a=e[r++];if(!(a&128)){s+=String.fromCharCode(a);continue}var l=e[r++]&63;if((a&224)==192){s+=String.fromCharCode((a&31)<<6|l);continue}var c=e[r++]&63;if((a&240)==224?a=(a&15)<<12|l<<6|c:a=(a&7)<<18|l<<12|c<<6|e[r++]&63,a<65536)s+=String.fromCharCode(a);else{var y=a-65536;s+=String.fromCharCode(55296|y>>10,56320|y&1023)}}return s},ce=(e,r)=>{var t=ue[e];r===0||r===10?((e===1?m:v)(Ve(t)),t.length=0):t.push(r)},Kr=()=>{Ge(0),ue[1].length&&ce(1,10),ue[2].length&&ce(2,10)},Yr=(e,r,t)=>e?Ve((f(),F),e,r):"";function xe(e,r,t,i){if(d)return K(3,0,1,e,r,t,i);for(var o=0,s=0;s<t;s++){var a=(f(),p)[r>>2],l=(f(),p)[r+4>>2];r+=8;for(var c=0;c<l;c++)ce(e,(f(),F)[a+c]);o+=l}return(f(),p)[i>>2]=o,0}var Xr=()=>e=>e.set(crypto.getRandomValues(new Uint8Array(e.byteLength))),ze=e=>{(ze=Xr())(e)},Qr=(e,r)=>(ze((f(),F).subarray(e,e+r)),0),Ke=e=>{var r=n["_"+e];return r},Gr=(e,r)=>{(f(),w).set(e,r)},Dr=e=>{for(var r=0,t=0;t<e.length;++t){var i=e.charCodeAt(t);i<=127?r++:i<=2047?r+=2:i>=55296&&i<=57343?(r+=4,++t):r+=3}return r},Zr=(e,r,t,i)=>{if(!(i>0))return 0;for(var o=t,s=t+i-1,a=0;a<e.length;++a){var l=e.codePointAt(a);if(l<=127){if(t>=s)break;r[t++]=l}else if(l<=2047){if(t+1>=s)break;r[t++]=192|l>>6,r[t++]=128|l&63}else if(l<=65535){if(t+2>=s)break;r[t++]=224|l>>12,r[t++]=128|l>>6&63,r[t++]=128|l&63}else{if(t+3>=s)break;r[t++]=240|l>>18,r[t++]=128|l>>12&63,r[t++]=128|l>>6&63,r[t++]=128|l&63,a++}}return r[t]=0,t-o},qr=(e,r,t)=>Zr(e,(f(),F),r,t),Jr=e=>{var r=Dr(e)+1,t=se(r);return qr(e,t,r),t},Ye=(e,r,t,i,o)=>{var s={string:g=>{var $=0;return g!=null&&g!==0&&($=Jr(g)),$},array:g=>{var $=se(g.length);return Gr(g,$),$}};function a(g){return r==="string"?Yr(g):r==="boolean"?!!g:g}var l=Ke(e),c=[],y=0;if(i)for(var R=0;R<i.length;R++){var ar=s[t[R]];ar?(y===0&&(y=Ie()),c[R]=ar(i[R])):c[R]=i[R]}var me=l(...c);function at(g){return y!==0&&ie(y),a(g)}return me=at(me),me},et=(e,r,t,i)=>{var o=!t||t.every(a=>a==="number"||a==="boolean"),s=r!=="string";return s&&o&&!i?Ke(e):(...a)=>Ye(e,r,t,a)};if(u.init(),or(),n.noExitRuntime&&(fe=n.noExitRuntime),n.print&&(m=n.print),n.printErr&&(v=n.printErr),n.wasmBinary&&(h=n.wasmBinary),n.arguments&&n.arguments,n.thisProgram&&n.thisProgram,n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.shift()();n.ccall=Ye,n.cwrap=et,n.setValue=Rr,n.getValue=br;var rt=[Ue,Se,Le,xe],Q,Xe,de,Qe,Ge,De,Ze,ve,qe,Je,er,rr,tr;function tt(e){n._bilateral_filter=e.s,n._gaussian_blur_fft=e.u,n._invert_image=e.v,n._threshold_image=e.w,n._black_threshold_image=e.x,n._kmeans=e.y,n._kmeans_clustering_graph=e.z,e.A,Q=e.B,Xe=e.C,de=e.D,Qe=e.E,Ge=e.F,n._malloc=e.G,n._free=e.H,De=e.I,Ze=e.J,ve=e.K,qe=e.L,Je=e.M,er=e.N,rr=e.O,tr=e.P}var nr;function nt(){nr={b:Mr,g:Ce,n:Pr,j:Ir,p:Sr,h:Br,d:Fr,i:le,l:Nr,e:Lr,k:jr,c:Hr,o:xr,q:oe,f:xe,a:T,m:Qr}}function G(){if(I>0){j=G;return}if(d){q?.(n),we();return}if(fr(),I>0){j=G;return}function e(){n.calledRun=!0,!O&&(we(),q?.(n),n.onRuntimeInitialized?.(),ur())}n.setStatus?(n.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>n.setStatus(""),1),e()},1)):e()}var U;return d||(U=await ke(),G()),ge?S=n:S=new Promise((e,r)=>{q=e,pe=r}),S}var ir=globalThis.self?.name?.startsWith("em-pthread");ir&&_e();let b,he;const sr=new Promise(M=>he=M);_e().then(M=>{b=M,he()}),self.onmessage=async({data:M})=>{await sr;const{id:S,funcName:n,args:E,bufferKeys:A}=M,d=Object.create(null);try{if(A)for(const _ of A){const m=E[_],v=m.byteLength,h=b._malloc(v);if(m instanceof Int32Array)b.HEAP32.set(m,h/Int32Array.BYTES_PER_ELEMENT);else if(m instanceof Uint8ClampedArray||m instanceof Uint8Array)b.HEAPU8.set(m,h);else throw new Error(`Unsupported TypedArray type for key: ${_}
If you added a new data type to useWasmWorker, please make sure to handle its type in wasmWorker`);d[_]={ptr:h,sizeInBytes:v,type:m.constructor},E[_]=h}const k=`_${n}`;if(typeof b[k]!="function")throw new Error(`WASM export not found: ${k}`);const D=b[k],N=n&&E?Object.values(E):[],Z=D(...N),P=Object.create(null);if(A)for(const _ of A){const{ptr:m,sizeInBytes:v,type:h}=d[_];if(h===Int32Array)P[_]=new Int32Array(b.HEAP32.buffer,m,v/Int32Array.BYTES_PER_ELEMENT).slice();else if(h===Uint8ClampedArray)P[_]=new Uint8ClampedArray(b.HEAPU8.subarray(m,m+v)).slice();else if(h===Uint8Array)P[_]=new Uint8Array(b.HEAPU8.subarray(m,m+v)).slice();else throw new Error(`Unsupported TypedArray type for output key: ${_}
If you added a new data type to useWasmWorker, please make sure to handle its type in wasmWorker`)}self.postMessage({id:S,output:P,returnValue:Z})}catch(k){self.postMessage({id:S,error:k.message})}finally{for(const{ptr:k}of Object.values(d))b._free(k)}}})();
